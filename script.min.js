import{initializeApp as e}from"https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";import{getAnalytics as t}from"https://www.gstatic.com/firebasejs/11.5.0/firebase-analytics.js";import{GoogleAuthProvider as n,signInWithPopup as a}from"https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";import{getAuth as s,createUserWithEmailAndPassword as o,signInWithEmailAndPassword as i,signOut as r,onAuthStateChanged as d}from"https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";import{getFirestore as l,collection as c,addDoc as m,getDocs as u,getDoc as p,doc as g,setDoc as y,updateDoc as v,query as f,where as h,orderBy as E,limit as b,serverTimestamp as L,onSnapshot as w,writeBatch as I,deleteDoc as T}from"https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";import{firebaseConfig as $,API_KEY as S}from"./config.js";const k=e($),_=(t(k),s(k)),B=l(k),x=new Map,C={"es-MX":{"auth.loginTitle":"Iniciar Sesi√≥n","auth.emailPlaceholder":"Correo electr√≥nico","auth.passwordPlaceholder":"Contrase√±a","auth.loginButton":"Iniciar Sesi√≥n","auth.continueWithGoogle":"Continuar con Google","auth.noAccount":"¬øNo tienes una cuenta?","auth.registerLink":"Reg√≠strate","auth.createAccountTitle":"Crear Cuenta","auth.fullNamePlaceholder":"Nombre completo","auth.confirmPasswordPlaceholder":"Confirmar contrase√±a","auth.registerButton":"Registrarse","auth.hasAccount":"¬øYa tienes una cuenta?","auth.loginLink":"Inicia sesi√≥n","nav.home":"Inicio","nav.movies":"Pel√≠culas","nav.series":"Series","nav.animes":"Animes","nav.doramas":"Doramas","nav.tv":"TV","search.placeholder":"Buscar t√≠tulos...","home.exploreByCategory":"Explorar por Categor√≠a","home.inTheaters":"En Estreno/Emisi√≥n","home.recentlyAdded":"Reci√©n Agregado","home.top10":"TOP 10 m√°s vistos","home.popularMovies":"Pel√≠culas populares","home.popularSeries":"Series populares","home.seeAll":"Ver todo","page.inTheatersTitle":"En Estreno","page.moviesTitle":"Pel√≠culas","page.seriesTitle":"Series","page.animesTitle":"Animes","page.doramasTitle":"Doramas","page.backButton":"Volver","page.loadMore":"Cargar M√°s","page.genreResultsTitle":"Resultados por G√©nero","page.searchResultsTitle":"Resultados de b√∫squeda","page.statsTitle":"Estad√≠sticas de Clicks","page.connectedUsersTitle":"Usuarios Conectados","profile.myProfile":"Mi Perfil","profile.info":"Informaci√≥n","profile.myList":"Mi Lista","profile.messages":"Mensajes","profile.settings":"Configuraci√≥n","profile.userDetails":"Detalles de Usuario","profile.nameLabel":"Nombre:","profile.emailLabel":"Correo:","profile.regDateLabel":"Fecha de registro:","profile.noMessages":"No tienes mensajes nuevos","profile.sendMessageToAdmin":"Enviar mensaje al administrador","profile.messagePlaceholder":"Escribe tu mensaje aqu√≠...","profile.messageLimitInfo":"Puedes enviar hasta 2 mensajes por d√≠a.","profile.sendMessageButton":"Enviar mensaje","admin.title":"Panel de Administrador","admin.usersTab":"Usuarios","admin.messagesTab":"Mensajes","admin.registeredUsers":"Usuarios Registrados","admin.activeUsers":"Usuarios Activos (√öltima Hora)","admin.userSearchPlaceholder":"Buscar usuarios por nombre o correo...","admin.recipientLabel":"Destinatario:","admin.allUsersOption":"Todos los usuarios","admin.messageLabel":"Mensaje:","admin.sendMessageButton":"Enviar Mensaje","admin.receivedMessages":"Mensajes Recibidos","admin.noReceivedMessages":"No hay mensajes recibidos","management.title":"Gesti√≥n de Contenido","management.addContentTab":"Agregar Contenido","management.manageContentTab":"Gestionar Contenido","management.addFromTMDb":"Agregar Contenido desde TMDB","management.searchPlaceholder":"Buscar pel√≠cula o serie por nombre...","management.searchButton":"Buscar","management.populateDb":"Poblar Base de Datos","management.populateDbInfo":"Usa este bot√≥n para agregar una selecci√≥n curada de contenido popular a la base de datos. Esto es √∫til para la configuraci√≥n inicial.","management.populateDbButton":"Poblar con Contenido Popular","management.manageImported":"Gestionar Contenido Importado","management.manageSearchPlaceholder":"Buscar contenido por t√≠tulo...","management.homeSectionsTab":"Secciones de Inicio","management.manageHomeSections":"Gestionar Secciones de Inicio","management.addSection":"Agregar Nueva Secci√≥n","management.sectionTitle":"T√≠tulo de la Secci√≥n","management.sectionType":"Tipo de Secci√≥n","management.sectionTypeCategory":"Categor√≠a","management.sectionTypeSingleImage":"Imagen √önica","management.sectionTypeView":"Vista","management.sectionTypeAdScript":"Anuncio (Script)","management.sectionTypeAdVideo":"Anuncio (Video Emergente)","management.noHomeSections":"No se han creado secciones de inicio.","management.loadHomeSectionsError":"Error al cargar las secciones de inicio. Aseg√∫rate de que los √≠ndices de Firestore est√°n configurados.","management.editSection":"Editar Secci√≥n","management.category":"Categor√≠a","management.imageUrl":"URL de la Imagen","management.linkType":"Tipo de Enlace","management.linkTypeMovie":"Pel√≠cula","management.linkTypeSeries":"Serie","management.linkTypeView":"Vista","management.linkTypeLink":"Enlace Externo","management.linkId":"ID del Enlace (ID de la Pel√≠cula/Serie o nombre de la vista)","management.embedUrl":"URL de Embed del Tr√°iler (opcional)","management.view":"Vista","management.adScript":"C√≥digo del Script del Anuncio","management.adVideoUrl":"URL del Video del Anuncio","management.sectionTitleRequired":"El t√≠tulo de la secci√≥n es obligatorio.","management.saveSectionError":"Error al guardar la secci√≥n.","management.saveOrderError":"Error al guardar el nuevo orden de las secciones.","management.addImage":"A√±adir Imagen","welcome.title":"Bienvenido a StreamFusion","welcome.subtitle":"Tu plataforma de entretenimiento streaming","welcome.intro":"StreamFusion es una app Gratuita de Entretenimiento Streaming que te permite disfrutar de todo tu contenido favorito en un solo lugar.","welcome.importantTitle":"IMPORTANTE","welcome.importantText":"En StreamFusion puedes hacer petici√≥n y reportar contenido que ya no este funcionando desde tu perfil o desde el apartado de la pelicula serie dando clic en el icono ‚ùï","welcome.enjoy":"No siendo m√°s disfruta del contenido. üéâ","welcome.dontShowAgain":"No mostrar m√°s","welcome.startButton":"Comenzar a explorar","modal.editUserTitle":"Editar Usuario","modal.nameLabel":"Nombre:","modal.emailLabel":"Correo electr√≥nico:","modal.cancelButton":"Cancelar","modal.saveButton":"Guardar","modal.sendMessageTitle":"Enviar Mensaje","modal.toLabel":"Para:","modal.messageLabel":"Mensaje:","modal.sendButton":"Enviar","modal.deleteConfirmTitle":"Confirmar Eliminaci√≥n","modal.deleteUserConfirmText":"¬øEst√°s seguro de que deseas eliminar este usuario? Esta acci√≥n no se puede deshacer.","modal.deleteButton":"Eliminar","modal.deleteMessageConfirmText":"¬øEst√°s seguro de que deseas eliminar este mensaje? Esta acci√≥n no se puede deshacer.","modal.importOptionsTitle":"Opciones de Importaci√≥n","modal.mainSectionsLabel":"Secciones Principales (d√≥nde aparecer√° el contenido):","modal.moviesSection":"Pel√≠culas","modal.seriesSection":"Series","modal.animesSection":"Animes","modal.doramasSection":"Doramas","modal.homeOptionsLabel":"Opciones de la P√°gina de Inicio:","modal.mainSliderSection":"Slider Principal","modal.inTheatersSection":"En Estreno/Emisi√≥n","modal.recentlyAddedSection":"Reci√©n Agregado","modal.platformsLabel":"Plataformas (si aplica):","modal.importButton":"Importar","modal.addVideoUrlsTitle":"Agregar URLs de Video","modal.importCsvButton":"Importar CSV","modal.saveAndContinueButton":"Guardar y Continuar","modal.saveLinksButton":"Guardar Enlaces","modal.deleteContentConfirmTitle":"Confirmar Eliminaci√≥n de Contenido","modal.deleteContentConfirmText":"¬øEst√°s seguro de que deseas eliminar este contenido? Esta acci√≥n no se puede deshacer.","modal.donationTitle":"Apoya nuestro proyecto","modal.donationText":"Tu donaci√≥n nos ayuda a mantener StreamFusion y seguir ofreciendo contenido de calidad sin costo.","modal.donationBenefit1":"Ayudas a mantener el servicio sin anuncios","modal.donationBenefit2":"Contribuyes al desarrollo de nuevas funciones","modal.donationBenefit3":"Apoyas a nuestro equipo de contenido","modal.donationNote":"Ser√°s redirigido al sitio seguro de PayPal para completar tu donaci√≥n.","modal.closeButton":"Cerrar","modal.acceptButton":"Aceptar","bottomNav.home":"Inicio","bottomNav.movies":"Pel√≠culas","bottomNav.series":"Series","bottomNav.animes":"Animes","bottomNav.tv":"TV","details.youMightLike":"Tambi√©n te podr√≠a gustar","details.season":"Temporada","details.noSeasons":"No se encontraron temporadas.","details.noEpisodes":"No se encontraron episodios.","details.episode":"Ep.","details.noDescription":"No hay descripci√≥n disponible.","details.director":"Director","details.creator":"Creador","details.cast":"Reparto","details.year":"A√±o","details.genre":"G√©nero","details.addToMyList":"Agregar a Mi Lista","details.videoNotAvailable":"Video no disponible.","user.profile.dropdown.myProfile":"Mi Perfil","user.profile.dropdown.adminPanel":"Panel de Admin","user.profile.dropdown.management":"Gesti√≥n","user.profile.dropdown.stats":"Estad√≠sticas","user.profile.dropdown.connected":"Conectado","user.profile.dropdown.logout":"Cerrar Sesi√≥n","user.profile.dropdown.login":"Iniciar Sesi√≥n","user.profile.dropdown.register":"Registrarse","user.profile.welcome":"Bienvenido","user.profile.restrictedAccess":"Acceso Restringido","user.profile.loginRequired":"Debes iniciar sesi√≥n o registrarte para acceder a tu perfil.","user.profile.myList.emptyTitle":"Tu lista est√° vac√≠a","user.profile.myList.emptyText":"A√±ade pel√≠culas y series para verlas aqu√≠.","user.profile.myList.loadError":"Error al cargar tu lista.","user.messages.loading":"Cargando mensajes...","modal.loading":"Cargando...","user.messages.loadError":"Ha ocurrido un error al cargar tus mensajes. Por favor, intenta de nuevo m√°s tarde.","user.messages.sender.admin":"Administrador","user.messages.sender.you":"Yo","user.messages.sender.system":"Sistema","user.messages.delete":"Eliminar","user.messages.messageLimit.canSend":"Puedes enviar {count} mensaje(s) m√°s hoy.","user.messages.messageLimit.limitReached":"Has alcanzado el l√≠mite de 2 mensajes por d√≠a. Intenta de nuevo ma√±ana.","user.messages.messageLimit.error":"Error al verificar l√≠mite de mensajes. Puedes intentar enviar un mensaje.","user.messages.adminNoLimit":"Puedes enviar mensajes al administrador.","user.messages.sendError.noMessage":"Por favor, escribe un mensaje.","user.messages.sendError.general":"Error al enviar el mensaje. Por favor, intenta de nuevo m√°s tarde.","user.messages.sendSuccess":"Tu mensaje ha sido enviado correctamente.","user.messages.deleteSuccess":"Mensaje eliminado correctamente.","user.messages.deleteError":"Error al eliminar el mensaje. Por favor, intenta de nuevo m√°s tarde.","user.messages.sending":"Enviando...","user.messages.sendMessage":"Enviar mensaje","content.type.movie":"Pel√≠cula","content.type.series":"Serie","content.noTitle":"Sin t√≠tulo","content.notAvailable":"N/A","content.newSticker":"Nuevo","content.noContent":"No se encontr√≥ contenido para mostrar en esta secci√≥n.","content.emptyState.title":"No hay contenido disponible","content.emptyState.text":"No se encontr√≥ contenido para mostrar en esta secci√≥n.","toast.addedToList":"Agregado a tu lista!","toast.alreadyInList":"Ya est√° en tu lista.","toast.addToListError":"Error al a√±adir a la lista.","toast.removeFromListError":"Error al eliminar el elemento de tu lista","genres.genreLabel":"G√©nero","genres.action":"Acci√≥n","genres.adventure":"Aventura","genres.animation":"Animaci√≥n","genres.comedy":"Comedia","genres.crime":"Crimen","genres.documentary":"Documental","genres.drama":"Drama","genres.family":"Familia","genres.fantasy":"Fantas√≠a","genres.history":"Historia","genres.horror":"Terror","genres.music":"M√∫sica","genres.mystery":"Misterio","genres.romance":"Romance","genres.science_fiction":"Ciencia Ficci√≥n","genres.tv_movie":"Pel√≠cula de TV","genres.thriller":"Suspenso","genres.war":"B√©lica","genres.western":"Occidental","genres.resultsFor":"Resultados para","genres.loadError":"Error al cargar el g√©nero.","admin.registeredLabel":"Registro:","admin.lastActivityLabel":"√öltima Actividad:","admin.fromLabel":"De:","admin.user":"Usuario","admin.never":"Nunca","admin.noAccess":"No tienes permisos para acceder a este panel.","admin.unknownUser":"Usuario desconocido","admin.statusLabel":"Estado:","admin.statusConnected":"Conectado","admin.noUsersFound":"No se encontraron usuarios.","admin.loadUsersError":"Error al cargar usuarios.","actions.list":"Lista","actions.watchNow":"Ver ahora","actions.info":"Info","actions.moreInfo":"M√°s informaci√≥n","actions.delete":"Eliminar","actions.edit":"Editar","actions.message":"Mensaje","actions.reply":"Responder","actions.addToList":"A√±adir a mi lista","actions.removeFromList":"Eliminar de la lista","actions.saving":"Guardando...","actions.added":"Agregado","actions.alreadyInList":"Ya en tu lista","actions.error":"Error","actions.import":"Importar","actions.updateUrls":"Actualizar URLs","actions.next":"Siguiente","modal.editDisplayOptions":"Editar Opciones de Visualizaci√≥n","modal.editUrlsTitle":"Editar URLs para:","modal.addUrlsTitle":"Agregar URLs para:","modal.videoUrlLabel":"URL del Video","modal.urlsUpdatedSuccess":"Las URLs se han actualizado correctamente.","modal.urlsUpdatedError":"No se pudieron actualizar las URLs.","modal.errorTitle":"Error","modal.loadUserError":"Error al cargar los datos del usuario.","modal.validationErrorTitle":"Error de Validaci√≥n","modal.validationErrorText":"Por favor, completa todos los campos.","modal.updateSuccessTitle":"Actualizaci√≥n Exitosa","modal.updateSuccessText":"Usuario actualizado correctamente.","modal.updateErrorTitle":"Error al Actualizar","modal.updateErrorText":"Error al actualizar el usuario. Por favor, intenta de nuevo m√°s tarde.","modal.deleteUserSuccessTitle":"Usuario Eliminado","modal.deleteUserSuccessText":"Usuario eliminado correctamente.","modal.deleteErrorTitle":"Error al Eliminar","modal.deleteErrorText":"Error al eliminar el usuario. Por favor, intenta de nuevo m√°s tarde.","modal.deleteContentSuccessTitle":"Contenido Eliminado","modal.deleteContentSuccessText":"El contenido se ha eliminado correctamente.","modal.deleteContentErrorTitle":"Error al Eliminar Contenido","modal.deleteContentErrorText":"No se pudo eliminar el contenido. Por favor, intenta de nuevo m√°s tarde.","modal.contentNotFound":"Este contenido no se encuentra en nuestra base de datos.","modal.notAuthorizedTitle":"No Autorizado","modal.notAuthorizedText":"No tienes permiso para importar contenido.","modal.duplicateContentTitle":"Contenido Duplicado","modal.duplicateContentText":"Esta pel√≠cula o serie ya ha sido importada.","modal.successTitle":"√âxito","modal.importSuccess":"'{title}' ha sido importado correctamente.","modal.saveOptionsError":"Ocurri√≥ un error al guardar las opciones.","modal.seedDbConfirm":"¬øEst√°s seguro de que quieres poblar la base de datos? Esto puede sobrescribir datos existentes si los IDs coinciden.","modal.seedDbSuccessTitle":"√âxito","modal.seedDbSuccessText":"Se importaron {importedCount} t√≠tulos y se omitieron {skippedCount} duplicados.","modal.seedDbError":"Ocurri√≥ un error al poblar la base de datos.","search.emptyQueryTitle":"B√∫squeda Vac√≠a","search.emptyQueryText":"Por favor, introduce un t√©rmino de b√∫squeda.","search.noResults":"No se encontraron resultados.","search.resultsFor":"Resultados para:","tmdb.searchError":"Error al buscar en TMDB","tmdb.searchErrorTitle":"Error de B√∫squeda","tmdb.searchErrorText":"No se pudieron obtener los resultados de TMDB.","trending.empty.title":"No hay tendencias disponibles","trending.empty.text":"A√∫n no hay suficientes datos de clics para mostrar tendencias.","hero.movieDescription":"Una pel√≠cula imperdible que te mantendr√° al borde de tu asiento.","hero.seriesDescription":"Una serie fascinante con personajes inolvidables y una trama adictiva.","donation.elementsNotFound":"Algunos elementos del modal de donaci√≥n no se encontraron","csv.importCompleteTitle":"Importaci√≥n de CSV Completa","csv.urlsImportedSuccess":"URLs importadas correctamente.","csv.rowsNotProcessed":"filas no se pudieron procesar.","csv.readErrorTitle":"Error de Lectura","csv.readErrorText":"No se pudo leer el archivo seleccionado.","settings.generalSettings":"Configuraci√≥n General","settings.importLanguage":"Idioma de Importaci√≥n de Contenido","settings.displayLanguage":"Idioma de Visualizaci√≥n","settings.heroSlider.title":"Hero Slider","settings.heroSlider.posterAmount":"Cantidad de Posters","settings.heroSlider.randomAmount":"Cantidad de Posters Aleatorios","settings.heroSlider.recentAmount":"Cantidad de Posters Recientes","settings.categoryVisibility":"Visibilidad de Categor√≠as","settings.platformVisibility":"Visibilidad de Plataformas","settings.homepagePosters.title":"Cantidad de Posters en Secciones de Inicio","settings.homepagePosters.inTheaters":"En Estreno/Emisi√≥n","settings.homepagePosters.recentlyAdded":"Reci√©n Agregado","settings.homepagePosters.popularMovies":"Pel√≠culas Populares","settings.homepagePosters.popularSeries":"Series Populares","settings.saveButton":"Guardar Configuraci√≥n","settings.saveSuccess":"La configuraci√≥n se ha guardado correctamente.","settings.saveError":"No se pudo guardar la configuraci√≥n."},"en-US":{"auth.loginTitle":"Login","auth.emailPlaceholder":"Email address","auth.passwordPlaceholder":"Password","auth.loginButton":"Login","auth.continueWithGoogle":"Continue with Google","auth.noAccount":"Don't have an account?","auth.registerLink":"Sign up","auth.createAccountTitle":"Create Account","auth.fullNamePlaceholder":"Full name","auth.confirmPasswordPlaceholder":"Confirm password","auth.registerButton":"Sign Up","auth.hasAccount":"Already have an account?","auth.loginLink":"Log in","nav.home":"Home","nav.movies":"Movies","nav.series":"Series","nav.animes":"Animes","nav.doramas":"Doramas","nav.tv":"TV","search.placeholder":"Search titles...","home.exploreByCategory":"Explore by Category","home.inTheaters":"Now Playing/Airing","home.recentlyAdded":"Recently Added","home.top10":"TOP 10 Most Viewed","home.popularMovies":"Popular Movies","home.popularSeries":"Popular Series","home.seeAll":"See all","page.inTheatersTitle":"Now Playing","page.moviesTitle":"Movies","page.seriesTitle":"Series","page.animesTitle":"Animes","page.doramasTitle":"Doramas","page.backButton":"Back","page.loadMore":"Load More","page.genreResultsTitle":"Genre Results","page.searchResultsTitle":"Search results","page.statsTitle":"Click Statistics","page.connectedUsersTitle":"Connected Users","profile.myProfile":"My Profile","profile.info":"Information","profile.myList":"My List","profile.messages":"Messages","profile.settings":"Settings","profile.userDetails":"User Details","profile.nameLabel":"Name:","profile.emailLabel":"Email:","profile.regDateLabel":"Registration date:","profile.noMessages":"You have no new messages","profile.sendMessageToAdmin":"Send message to administrator","profile.messagePlaceholder":"Write your message here...","profile.messageLimitInfo":"You can send up to 2 messages per day.","profile.sendMessageButton":"Send Message","admin.title":"Administrator Panel","admin.usersTab":"Users","admin.messagesTab":"Messages","admin.registeredUsers":"Registered Users","admin.activeUsers":"Active Users (Last Hour)","admin.userSearchPlaceholder":"Search users by name or email...","admin.recipientLabel":"Recipient:","admin.allUsersOption":"All users","admin.messageLabel":"Message:","admin.sendMessageButton":"Send Message","admin.receivedMessages":"Received Messages","admin.noReceivedMessages":"No messages received","management.title":"Content Management","management.addContentTab":"Add Content","management.manageContentTab":"Manage Content","management.addFromTMDb":"Add Content from TMDB","management.searchPlaceholder":"Search movie or series by name...","management.searchButton":"Search","management.populateDb":"Populate Database","management.populateDbInfo":"Use this button to add a curated selection of popular content to the database. This is useful for initial setup.","management.populateDbButton":"Populate with Popular Content","management.manageImported":"Manage Imported Content","management.manageSearchPlaceholder":"Search content by title...","welcome.title":"Welcome to StreamFusion","welcome.subtitle":"Your streaming entertainment platform","welcome.intro":"StreamFusion is a Free Streaming Entertainment App that allows you to enjoy all your favorite content in one place.","welcome.importantTitle":"IMPORTANT","welcome.importantText":"In StreamFusion you can request and report content that is no longer working from your profile or from the movie/series section by clicking on the ‚ùï icon","welcome.enjoy":"That being said, enjoy the content. üéâ","welcome.dontShowAgain":"Don't show again","welcome.startButton":"Start exploring","modal.editUserTitle":"Edit User","modal.nameLabel":"Name:","modal.emailLabel":"Email address:","modal.cancelButton":"Cancel","modal.saveButton":"Save","modal.sendMessageTitle":"Send Message","modal.toLabel":"To:","modal.messageLabel":"Message:","modal.sendButton":"Send","modal.deleteConfirmTitle":"Confirm Deletion","modal.deleteUserConfirmText":"Are you sure you want to delete this user? This action cannot be undone.","modal.deleteButton":"Delete","modal.deleteMessageConfirmText":"Are you sure you want to delete this message? This action cannot be undone.","modal.importOptionsTitle":"Import Options","modal.mainSectionsLabel":"Main Sections (where the content will appear):","modal.moviesSection":"Movies","modal.seriesSection":"Series","modal.animesSection":"Animes","modal.doramasSection":"Doramas","modal.homeOptionsLabel":"Home Page Options:","modal.mainSliderSection":"Main Slider","modal.inTheatersSection":"Now Playing/Airing","modal.recentlyAddedSection":"Recently Added","modal.platformsLabel":"Platforms (if applicable):","modal.importButton":"Import","modal.addVideoUrlsTitle":"Add Video URLs","modal.importCsvButton":"Import CSV","modal.saveAndContinueButton":"Save and Continue","modal.saveLinksButton":"Save Links","modal.deleteContentConfirmTitle":"Confirm Content Deletion","modal.deleteContentConfirmText":"Are you sure you want to delete this content? This action cannot be undone.","modal.donationTitle":"Support our project","modal.donationText":"Your donation helps us maintain StreamFusion and continue to offer quality content at no cost.","modal.donationBenefit1":"You help keep the service ad-free","modal.donationBenefit2":"You contribute to the development of new features","modal.donationBenefit3":"You support our content team","modal.donationNote":"You will be redirected to the secure PayPal site to complete your donation.","modal.closeButton":"Close","modal.acceptButton":"Accept","bottomNav.home":"Home","bottomNav.movies":"Movies","bottomNav.series":"Series","bottomNav.animes":"Animes","bottomNav.tv":"TV","details.youMightLike":"You might also like","details.season":"Season","details.noSeasons":"No seasons found.","details.noEpisodes":"No episodes found.","details.episode":"Ep.","details.noDescription":"No description available.","details.director":"Director","details.creator":"Creator","details.cast":"Cast","details.year":"Year","details.genre":"Genre","details.addToMyList":"Add to My List","details.videoNotAvailable":"Video not available.","user.profile.dropdown.myProfile":"My Profile","user.profile.dropdown.adminPanel":"Admin Panel","user.profile.dropdown.management":"Management","user.profile.dropdown.stats":"Statistics","user.profile.dropdown.connected":"Connected","user.profile.dropdown.logout":"Logout","user.profile.dropdown.login":"Login","user.profile.dropdown.register":"Sign Up","user.profile.welcome":"Welcome","user.profile.restrictedAccess":"Restricted Access","user.profile.loginRequired":"You must log in or register to access your profile.","user.profile.myList.emptyTitle":"Your list is empty","user.profile.myList.emptyText":"Add movies and series to see them here.","user.profile.myList.loadError":"Error loading your list.","user.messages.loading":"Loading messages...","modal.loading":"Cargando...","user.messages.loadError":"An error occurred while loading your messages. Please try again later.","user.messages.sender.admin":"Administrator","user.messages.sender.you":"You","user.messages.sender.system":"System","user.messages.delete":"Delete","user.messages.messageLimit.canSend":"You can send {count} more message(s) today.","user.messages.messageLimit.limitReached":"You have reached the limit of 2 messages per day. Try again tomorrow.","user.messages.messageLimit.error":"Error checking message limit. You can try sending a message.","user.messages.adminNoLimit":"You can send messages to the administrator.","user.messages.sendError.noMessage":"Please write a message.","user.messages.sendError.general":"Error sending message. Please try again later.","user.messages.sendSuccess":"Your message has been sent successfully.","user.messages.deleteSuccess":"Message deleted successfully.","user.messages.deleteError":"Error deleting message. Please try again later.","user.messages.sending":"Sending...","user.messages.sendMessage":"Send Message","content.type.movie":"Movie","content.type.series":"Series","content.noTitle":"No title","content.notAvailable":"N/A","content.newSticker":"New","content.noContent":"No content found to display in this section.","content.emptyState.title":"No content available","content.emptyState.text":"No content found to display in this section.","toast.addedToList":"Added to your list!","toast.alreadyInList":"Already in your list.","toast.addToListError":"Error adding to list.","toast.removeFromListError":"Error removing item from your list","genres.genreLabel":"Genre","genres.action":"Action","genres.adventure":"Adventure","genres.animation":"Animation","genres.comedy":"Comedy","genres.crime":"Crime","genres.documentary":"Documentary","genres.drama":"Drama","genres.family":"Family","genres.fantasy":"Fantasy","genres.history":"History","genres.horror":"Horror","genres.music":"Music","genres.mystery":"Mystery","genres.romance":"Romance","genres.science_fiction":"Science Fiction","genres.tv_movie":"TV Movie","genres.thriller":"Thriller","genres.war":"War","genres.western":"Western","genres.resultsFor":"Results for","genres.loadError":"Error loading genre.","genres.genreLabel":"Genre","admin.registeredLabel":"Registered:","admin.lastActivityLabel":"Last Activity:","admin.fromLabel":"From:","admin.user":"User","admin.never":"Never","admin.noAccess":"You do not have permission to access this panel.","admin.unknownUser":"Unknown user","admin.statusLabel":"Status:","admin.statusConnected":"Connected","admin.noUsersFound":"No users found.","admin.loadUsersError":"Error loading users.","actions.list":"List","actions.watchNow":"Watch Now","actions.info":"Info","actions.moreInfo":"More Info","actions.delete":"Delete","actions.edit":"Edit","actions.message":"Message","actions.reply":"Reply","actions.addToList":"Add to My List","actions.removeFromList":"Remove from list","actions.saving":"Saving...","actions.added":"Added","actions.alreadyInList":"Already in list","actions.error":"Error","actions.import":"Import","actions.updateUrls":"Update URLs","actions.next":"Next","modal.editDisplayOptions":"Edit Display Options","modal.editUrlsTitle":"Edit URLs for:","modal.addUrlsTitle":"Add URLs for:","modal.videoUrlLabel":"Video URL","modal.urlsUpdatedSuccess":"URLs have been updated successfully.","modal.urlsUpdatedError":"Could not update URLs.","modal.errorTitle":"Error","modal.loadUserError":"Error loading user data.","modal.validationErrorTitle":"Validation Error","modal.validationErrorText":"Please fill out all fields.","modal.updateSuccessTitle":"Update Successful","modal.updateSuccessText":"User updated successfully.","modal.updateErrorTitle":"Update Error","modal.updateErrorText":"Error updating user. Please try again later.","modal.deleteUserSuccessTitle":"User Deleted","modal.deleteUserSuccessText":"User deleted successfully.","modal.deleteErrorTitle":"Deletion Error","modal.deleteErrorText":"Error deleting user. Please try again later.","modal.deleteContentSuccessTitle":"Content Deleted","modal.deleteContentSuccessText":"The content has been deleted successfully.","modal.deleteContentErrorTitle":"Error Deleting Content","modal.deleteContentErrorText":"Could not delete the content. Please try again later.","modal.contentNotFound":"This content is not in our database.","modal.notAuthorizedTitle":"Not Authorized","modal.notAuthorizedText":"You do not have permission to import content.","modal.duplicateContentTitle":"Duplicate Content","modal.duplicateContentText":"This movie or series has already been imported.","modal.successTitle":"Success","modal.importSuccess":"'{title}' has been imported successfully.","modal.saveOptionsError":"An error occurred while saving the options.","modal.seedDbConfirm":"Are you sure you want to populate the database? This may overwrite existing data if IDs match.","modal.seedDbSuccessTitle":"Success","modal.seedDbSuccessText":"{importedCount} titles were imported and {skippedCount} duplicates were skipped.","modal.seedDbError":"An error occurred while populating the database.","search.emptyQueryTitle":"Empty Search","search.emptyQueryText":"Please enter a search term.","search.noResults":"No results found.","search.resultsFor":"Results for:","tmdb.searchError":"Error searching TMDB","tmdb.searchErrorTitle":"Search Error","tmdb.searchErrorText":"Could not retrieve results from TMDB.","trending.empty.title":"No trends available","trending.empty.text":"There is not enough click data to show trends yet.","hero.movieDescription":"A must-see movie that will keep you on the edge of your seat.","hero.seriesDescription":"A fascinating series with unforgettable characters and an addictive plot.","donation.elementsNotFound":"Some donation modal elements were not found","csv.importCompleteTitle":"CSV Import Complete","csv.urlsImportedSuccess":"URLs imported successfully.","csv.rowsNotProcessed":"rows could not be processed.","csv.readErrorTitle":"Read Error","csv.readErrorText":"Could not read the selected file.","settings.generalSettings":"General Settings","settings.importLanguage":"Content Import Language","settings.displayLanguage":"Display Language","settings.heroSlider.title":"Hero Slider","settings.heroSlider.posterAmount":"Number of Posters","settings.heroSlider.randomAmount":"Number of Random Posters","settings.heroSlider.recentAmount":"Number of Recent Posters","settings.categoryVisibility":"Category Visibility","settings.platformVisibility":"Platform Visibility","settings.homepagePosters.title":"Number of Posters in Home Sections","settings.homepagePosters.inTheaters":"Now Playing/Airing","settings.homepagePosters.recentlyAdded":"Recently Added","settings.homepagePosters.popularMovies":"Popular Movies","settings.homepagePosters.popularSeries":"Popular Series","settings.saveButton":"Save Settings","settings.saveSuccess":"Settings have been saved successfully.","settings.saveError":"Could not save settings."}};function A(e,t={}){const n=Fn.displayLanguage||"es-MX";let a=C[n]?.[e]||C["es-MX"]?.[e]||e;for(const e in t)a=a.replace(`{${e}}`,t[e]);return a}function M(){document.querySelectorAll("[data-translate]").forEach(e=>{const t=e.getAttribute("data-translate");e.textContent=A(t)}),document.querySelectorAll("[data-translate-placeholder]").forEach(e=>{const t=e.getAttribute("data-translate-placeholder");e.placeholder=A(t)})}(()=>{const e={logo:atob("U3RyZWFtRnVzaW9u"),checks:[]};function t(){try{const t=document.querySelector("h1.logo-text");if(!t)return!1;return t.textContent.trim()===e.logo||(n("LOGO_MODIFIED"),!1)}catch(e){return!1}}function n(e){try{const t=document.createElement("div");t.id="license-lockdown",t.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(135deg, #1a1a1a 0%, #2d0a0a 100%);\n        z-index: 999999;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n      ",t.innerHTML=`\n        <div style="text-align: center; color: #fff; max-width: 600px; padding: 40px;">\n          <div style="font-size: 80px; margin-bottom: 20px;">üîí</div>\n          <h1 style="font-size: 32px; margin-bottom: 20px; color: #ff4444;">Sistema Bloqueado</h1>\n          <p style="font-size: 18px; line-height: 1.6; margin-bottom: 30px; color: #ccc;">\n            Esta licencia no es valida.\n          </p>\n          <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">\n            <p style="font-size: 14px; color: #ff6666; font-family: monospace;">\n              C√≥digo de error: ${e}\n            </p>\n          </div>\n          <p style="font-size: 14px; color: #999;">\n            Obten una licencia v√°lida en <a href="https://t.me/blackdestroy06">Telegram</a>\n          </p>\n        </div>\n      `,document.body.innerHTML="",document.body.appendChild(t),document.body.style.overflow="hidden",document.body.style.userSelect="none"}catch(e){}}function a(){try{const a=setInterval(()=>{try{if(t()){clearInterval(a),function(){try{const a=document.querySelector("h1.logo-text");if(!a)return;const s=new MutationObserver(e=>{try{e.forEach(e=>{"childList"!==e.type&&"characterData"!==e.type||t()||n("LOGO_MUTATION_DETECTED")})}catch(e){}});s.observe(a,{childList:!0,characterData:!0,subtree:!0}),e.checks.push(s)}catch(e){}}(),function(){try{const a=setInterval(()=>{try{t()||(clearInterval(a),n("PERIODIC_CHECK_FAILED"))}catch(e){}},3e3);e.checks.push(a)}catch(e){}}(),window._sfLicenseCore=!0;try{Object.defineProperty(window,"_sfLicenseCore",{configurable:!1,writable:!1,value:!0})}catch(e){}}}catch(e){}},100)}catch(e){}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()})(),(()=>{function e(){try{return!(void 0===window._sfLicenseCore||!window._sfLicenseCore)||(t("CORE_LICENSE_MISSING"),!1)}catch(e){return t("VERIFICATION_ERROR"),!1}}function t(e){try{document.body.innerHTML=`\n        <div style="position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 999999;">\n          <div style="text-align: center; color: #f00; font-family: monospace;">\n            <h1 style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è ACCESO DENEGADO ‚ö†Ô∏è</h1>\n            <p style="font-size: 20px;">Violaci√≥n de integridad detectada</p>\n            <p style="font-size: 14px; margin-top: 20px; color: #666;">Error: ${e}</p>\n          </div>\n        </div>\n      `,document.body.style.overflow="hidden"}catch(e){}}function n(){try{setTimeout(()=>{try{if(!e())return void t("CORE_LICENSE_NOT_FOUND");!function(){try{setInterval(()=>{try{e()||t("CORE_LICENSE_REMOVED")}catch(e){}},5e3)}catch(e){}}(),window._sfLicenseValidator2=!0;try{Object.defineProperty(window,"_sfLicenseValidator2",{configurable:!1,writable:!1,value:!0})}catch(e){}}catch(e){}},1500)}catch(e){}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()})(),(()=>{function e(){try{const e=void 0!==window._sfLicenseCore&&window._sfLicenseCore,n=void 0!==window._sfLicenseValidator2&&window._sfLicenseValidator2;return e?!!n||(t("VALIDATOR2_MISSING"),!1):(t("CORE_LICENSE_MISSING"),!1)}catch(e){return t("CHAIN_VERIFICATION_ERROR"),!1}}function t(e){try{document.body.innerHTML=`\n        <div style="position: fixed; inset: 0; background: linear-gradient(45deg, #1a0000, #000); display: flex; align-items: center; justify-content: center; z-index: 999999; font-family: Arial, sans-serif;">\n          <div style="max-width: 500px; padding: 40px; background: rgba(255,0,0,0.1); border: 2px solid #ff0000; border-radius: 10px; text-align: center;">\n            <div style="font-size: 60px; margin-bottom: 20px;">üö´</div>\n            <h1 style="color: #ff3333; font-size: 28px; margin-bottom: 15px;">Error Cr√≠tico de Licencia</h1>\n            <p style="color: #ffaaaa; font-size: 16px; line-height: 1.5; margin-bottom: 20px;">\n              Violaci√≥n de integridad del sistema detectada.\n            </p>\n            <div style="background: rgba(0,0,0,0.5); padding: 15px; border-radius: 5px; margin-bottom: 20px;">\n              <code style="color: #ff6666; font-size: 12px;">${e}</code>\n            </div>\n            <p style="color: #999; font-size: 12px;">\n              Obten una licencia v√°lida en <a href="https://t.me/blackdestroy06">Telegram</a>\n            </p>\n          </div>\n        </div>\n      `,document.body.style.overflow="hidden"}catch(e){}}function n(){try{setTimeout(()=>{try{if(!e())return void t("LICENSE_CHAIN_INCOMPLETE");!function(){try{setInterval(()=>{try{e()||t("LICENSE_CHAIN_BROKEN")}catch(e){}},4e3)}catch(e){}}(),window._sfLicenseValidator3=!0;try{Object.defineProperty(window,"_sfLicenseValidator3",{configurable:!1,writable:!1,value:!0})}catch(e){}}catch(e){}},2500)}catch(e){}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()})();const N="https://api.themoviedb.org/3",P="https://image.tmdb.org/t/p",D=[{key:"genres.action",icon:"fas fa-fire",genreId:28},{key:"genres.adventure",icon:"fas fa-compass",genreId:12},{key:"genres.animation",icon:"fas fa-child",genreId:16},{key:"genres.comedy",icon:"fas fa-laugh",genreId:35},{key:"genres.crime",icon:"fas fa-mask",genreId:80},{key:"genres.documentary",icon:"fas fa-camera",genreId:99},{key:"genres.drama",icon:"fas fa-theater-masks",genreId:18},{key:"genres.family",icon:"fas fa-home",genreId:10751},{key:"genres.fantasy",icon:"fas fa-hat-wizard",genreId:14},{key:"genres.history",icon:"fas fa-landmark",genreId:36},{key:"genres.horror",icon:"fas fa-ghost",genreId:27},{key:"genres.music",icon:"fas fa-music",genreId:10402},{key:"genres.mystery",icon:"fas fa-search",genreId:9648},{key:"genres.romance",icon:"fas fa-heart",genreId:10749},{key:"genres.science_fiction",icon:"fas fa-rocket",genreId:878},{key:"genres.tv_movie",icon:"fas fa-tv",genreId:10770},{key:"genres.thriller",icon:"fas fa-exclamation-triangle",genreId:53},{key:"genres.war",icon:"fas fa-fighter-jet",genreId:10752},{key:"genres.western",icon:"fas fa-hat-cowboy",genreId:37}],H=document.getElementById("auth-container"),U=document.getElementById("auth-close-btn"),q=document.getElementById("login-form-container"),R=document.getElementById("register-form-container"),j=document.getElementById("login-form"),O=document.getElementById("register-form"),V=document.getElementById("login-email"),F=document.getElementById("login-password"),z=document.getElementById("register-name"),G=document.getElementById("register-email"),Y=document.getElementById("register-password"),W=document.getElementById("register-confirm-password"),X=document.getElementById("login-error"),Z=document.getElementById("register-error"),Q=document.getElementById("register-success"),K=document.getElementById("show-register"),J=document.getElementById("show-login"),ee=document.getElementById("spinner-container"),te=document.getElementById("header"),ne=document.getElementById("search-btn"),ae=document.getElementById("search-input"),se=document.getElementById("back-to-top"),oe=document.getElementById("welcome-popup"),ie=document.getElementById("close-popup"),re=document.getElementById("dont-show-again"),de=document.querySelectorAll(".service-item"),le=document.getElementById("hero"),ce=document.getElementById("en-estreno-slider"),me=document.getElementById("trending-slider"),ue=document.getElementById("movies-slider"),pe=document.getElementById("series-slider"),ge=document.querySelectorAll(".slider-prev"),ye=document.querySelectorAll(".slider-next"),ve=document.getElementById("services-back-btn"),fe=(document.getElementById("categories-container"),document.getElementById("user-profile"),document.getElementById("profile-icon")),he=document.getElementById("profile-dropdown"),Ee=document.getElementById("user-profile-page"),be=document.getElementById("profile-avatar"),Le=document.getElementById("profile-name"),we=document.getElementById("profile-email"),Ie=document.getElementById("info-name"),Te=document.getElementById("info-email"),$e=document.getElementById("info-date"),Se=document.querySelectorAll(".profile-tab"),ke=document.querySelectorAll(".profile-section"),_e=document.getElementById("profile-my-list-grid"),Be=document.getElementById("messages-list"),xe=document.getElementById("no-messages"),Ce=document.getElementById("back-from-profile"),Ae=(document.getElementById("user-message-form"),document.getElementById("user-message-content")),Me=document.getElementById("send-user-message-btn"),Ne=document.getElementById("message-limit-info"),Pe=document.getElementById("admin-panel"),De=document.querySelectorAll("#admin-panel .admin-tab"),He=document.querySelectorAll("#admin-panel .admin-section"),Ue=document.getElementById("users-grid"),qe=document.getElementById("admin-message-form"),Re=document.getElementById("message-recipient"),je=document.getElementById("message-content"),Oe=document.getElementById("back-from-admin"),Ve=document.getElementById("registered-users-count"),Fe=document.getElementById("active-users-count"),ze=document.getElementById("user-search-input"),Ge=document.getElementById("management-panel"),Ye=document.getElementById("back-from-management"),We=document.querySelectorAll("#management-tabs .admin-tab"),Xe=document.querySelectorAll("#management-panel .admin-section"),Ze=document.getElementById("admin-messages-list"),Qe=document.getElementById("admin-no-messages"),Ke=document.querySelector('.profile-tab[data-tab="settings"]'),Je=(document.getElementById("settings-section"),document.getElementById("settings-form")),et=document.getElementById("import-language"),tt=document.getElementById("display-language"),nt=document.getElementById("hero-slider-posters"),at=document.getElementById("hero-slider-random"),st=document.getElementById("hero-slider-recent"),ot=document.getElementById("visible-categories"),it=document.getElementById("visible-platforms"),rt=document.getElementById("posters-en-estreno"),dt=document.getElementById("posters-recien-agregado"),lt=document.getElementById("posters-peliculas-populares"),ct=document.getElementById("posters-series-populares"),mt=document.getElementById("import-options-modal"),ut=document.getElementById("close-import-options-modal"),pt=(document.getElementById("import-main-section"),document.getElementById("home-options-container")),gt=document.getElementById("cancel-import"),yt=document.getElementById("confirm-import"),vt=(document.getElementById("import-item-id"),document.getElementById("import-item-type"),document.getElementById("edit-user-modal")),ft=(document.getElementById("edit-user-form"),document.getElementById("edit-name")),ht=document.getElementById("edit-email"),Et=document.getElementById("edit-user-id"),bt=document.getElementById("close-edit-modal"),Lt=document.getElementById("cancel-edit"),wt=document.getElementById("save-edit"),It=document.getElementById("send-message-modal"),Tt=(document.getElementById("send-message-form"),document.getElementById("message-to")),$t=document.getElementById("individual-message-content"),St=document.getElementById("message-user-id"),kt=document.getElementById("close-message-modal"),_t=document.getElementById("cancel-message"),Bt=document.getElementById("send-message"),xt=document.getElementById("delete-confirmation-modal"),Ct=document.getElementById("delete-user-id"),At=document.getElementById("close-delete-modal"),Mt=document.getElementById("cancel-delete"),Nt=document.getElementById("confirm-delete"),Pt=document.getElementById("delete-message-modal"),Dt=document.getElementById("delete-message-id"),Ht=document.getElementById("close-delete-message-modal"),Ut=document.getElementById("cancel-delete-message"),qt=document.getElementById("confirm-delete-message"),Rt=document.getElementById("delete-content-confirmation-modal"),jt=document.getElementById("close-delete-content-modal"),Ot=document.getElementById("cancel-delete-content"),Vt=document.getElementById("confirm-delete-content"),Ft=document.getElementById("delete-content-id"),zt=document.getElementById("message-modal"),Gt=document.getElementById("message-modal-title"),Yt=document.getElementById("message-modal-content"),Wt=document.getElementById("close-message-modal-btn"),Xt=document.getElementById("message-modal-ok-btn"),Zt=document.getElementById("video-url-modal"),Qt=document.getElementById("video-url-modal-title"),Kt=document.getElementById("video-url-modal-body"),Jt=document.getElementById("close-video-url-modal"),en=document.getElementById("cancel-video-url"),tn=document.getElementById("save-video-urls"),nn=document.getElementById("import-csv-btn"),an=document.getElementById("csv-file-input"),sn=document.querySelectorAll(".nav-link"),on=document.querySelectorAll(".bottom-nav-item"),rn=document.getElementById("see-all-movies"),dn=document.getElementById("see-all-series"),ln=document.getElementById("see-all-en-estreno"),cn=document.getElementById("back-from-movies"),mn=document.getElementById("back-from-series"),un=document.getElementById("back-from-animes"),pn=document.getElementById("back-from-doramas"),gn=document.getElementById("back-from-genre"),yn=document.getElementById("back-from-search"),vn=document.getElementById("back-from-en-estreno"),fn=(document.getElementById("back-from-stats"),document.getElementById("back-from-connected-users"),document.getElementById("home-view")),hn=document.getElementById("movies-view"),En=document.getElementById("series-view"),bn=document.getElementById("animes-view"),Ln=document.getElementById("doramas-view"),wn=document.getElementById("genre-results-view"),In=document.getElementById("search-results-view"),Tn=document.getElementById("en-estreno-view"),$n=document.getElementById("netflix-view"),Sn=document.getElementById("disney-view"),kn=document.getElementById("hbo-view"),_n=document.getElementById("prime-view"),Bn=document.getElementById("paramount-view"),xn=document.getElementById("stats-view"),Cn=document.getElementById("connected-users-view"),An=document.getElementById("movies-grid"),Mn=document.getElementById("series-grid"),Nn=document.getElementById("animes-grid"),Pn=document.getElementById("doramas-grid"),Dn=document.getElementById("genre-results-grid"),Hn=document.getElementById("search-results-grid"),Un=document.getElementById("en-estreno-grid"),qn=(document.getElementById("netflix-grid"),document.getElementById("disney-grid"),document.getElementById("hbo-grid"),document.getElementById("prime-grid"),document.getElementById("paramount-grid"),document.getElementById("stats-grid")),Rn=document.getElementById("connected-users-grid"),jn=document.getElementById("genre-title"),On=document.getElementById("search-results-title");let Vn,Fn={importLanguage:"es-MX",displayLanguage:"es-MX",heroSlider:{posters:8,random:4,recent:4},visibleCategories:[],visiblePlatforms:[],homepageSections:{enEstreno:20,recienAgregado:20,peliculasPopulares:20,seriesPopulares:20}},zn=null,Gn=0,Yn=!0,Wn=[],Xn=[],Zn=[],Qn=[],Kn=[],Jn="home",ea=[],ta=[],na=null,aa=!1,sa={},oa=null,ia=[],ra=!1,da=null,la=null,ca=1;let ma=!1,ua=[],pa=null,ga=1;let ya=!1,va=[],fa=1;let ha=!1,Ea=[];const ba="javiervelasquez0618@gmail.com";function La(){const e=new n;e.setCustomParameters({prompt:"select_account"}),a(_,e).then(e=>{fs(),ka()}).catch(e=>{hs(),console.error("Error en autenticaci√≥n con Google:",e),X.textContent="Error al iniciar sesi√≥n con Google. Int√©ntalo de nuevo.",X.style.display="block",Z.textContent="Error al registrarse con Google. Int√©ntalo de nuevo.",Z.style.display="block"})}async function wa(e){e.preventDefault();const t=V.value.trim(),n=F.value;fs();try{await i(_,t,n),j.reset(),X.style.display="none"}catch(e){hs(),X.textContent=Ta(e.code),X.style.display="block"}}async function Ia(e){e.preventDefault();const t=z.value.trim(),n=G.value.trim(),a=Y.value;if(a!==W.value)return Z.textContent="Las contrase√±as no coinciden",Z.style.display="block",void(Q.style.display="none");fs();try{const e=(await o(_,n,a)).user;await y(g(B,"users",e.uid),{name:t,email:n,registeredAt:L(),myList:[],messagesSent:[],lastActivity:L(),isAdmin:e.email===ba}),Z.style.display="none",Q.textContent="Registro exitoso. Iniciando sesi√≥n...",Q.style.display="block",O.reset()}catch(e){hs(),Z.textContent=Ta(e.code),Z.style.display="block",Q.style.display="none"}}function Ta(e){switch(e){case"auth/email-already-in-use":return"Este correo electr√≥nico ya est√° registrado";case"auth/invalid-email":return"Correo electr√≥nico inv√°lido";case"auth/weak-password":return"La contrase√±a debe tener al menos 6 caracteres";case"auth/user-not-found":case"auth/wrong-password":return"Correo electr√≥nico o contrase√±a incorrectos";default:return"Error de autenticaci√≥n: "+e}}function $a(){if(he.innerHTML="",na){fe.innerHTML=na.name.charAt(0).toUpperCase(),fe.title=`${A("user.profile.welcome")}, ${na.name}`;const e=document.createElement("div");if(e.className="profile-dropdown-item",e.id="view-profile",e.innerHTML=`<i class="fas fa-user-circle"></i><span data-translate="user.profile.dropdown.myProfile">${A("user.profile.dropdown.myProfile")}</span>`,e.addEventListener("click",()=>{he.classList.remove("active"),function(){if(!na)return void Sa();fn.classList.remove("active"),hn.classList.remove("active"),En.classList.remove("active"),bn.classList.remove("active"),Ln.classList.remove("active"),wn.classList.remove("active"),In.classList.remove("active"),Ee.classList.remove("active"),Pe.classList.remove("active"),Ge.classList.remove("active"),Tn.classList.remove("active"),$n.classList.remove("active"),Sn.classList.remove("active"),kn.classList.remove("active"),_n.classList.remove("active"),Bn.classList.remove("active"),xn.classList.remove("active"),Cn.classList.remove("active"),Ee.classList.add("active"),be.textContent=na.name.charAt(0).toUpperCase(),Le.textContent=na.name,we.textContent=na.email,Ie.textContent=na.name,Te.textContent=na.email;const e=na.registeredAt instanceof Date?na.registeredAt:na.registeredAt?.toDate?.()||new Date;$e.textContent=e.toLocaleDateString(),Se.forEach(e=>e.classList.remove("active")),ke.forEach(e=>e.classList.remove("active")),Se[0].classList.add("active"),ke[0].classList.add("active"),xa(),Ca(),Ma(),aa&&function(){if(!aa||!Je)return;et.value=Fn.importLanguage,tt.value=Fn.displayLanguage,nt.value=Fn.heroSlider.posters,at.value=Fn.heroSlider.random,st.value=Fn.heroSlider.recent,rt.value=Fn.homepageSections.enEstreno,dt.value=Fn.homepageSections.recienAgregado,lt.value=Fn.homepageSections.peliculasPopulares,ct.value=Fn.homepageSections.seriesPopulares,0===Fn.visibleCategories.length&&(Fn.visibleCategories=D.map(e=>String(e.genreId)));ot.innerHTML=D.map(e=>`\n    <label>\n      <input type="checkbox" name="visible-category" value="${e.genreId}" ${Fn.visibleCategories.includes(String(e.genreId))?"checked":""}>\n      ${A(e.key)}\n    </label>\n  `).join("");const e=[{name:"Netflix",id:"netflix"},{name:"Disney+",id:"disney"},{name:"HBO Max",id:"hbo"},{name:"Prime Video",id:"prime"},{name:"Paramount+",id:"paramount"}];0===Fn.visiblePlatforms.length&&(Fn.visiblePlatforms=e.map(e=>e.id));it.innerHTML=e.map(e=>`\n    <label>\n      <input type="checkbox" name="visible-platform" value="${e.id}" ${Fn.visiblePlatforms.includes(e.id)?"checked":""}>\n      ${e.name}\n    </label>\n  `).join("")}()}()}),he.appendChild(e),aa){const e=document.createElement("div");e.className="profile-dropdown-item",e.id="admin-panel-link",e.innerHTML=`<i class="fas fa-cog"></i><span data-translate="user.profile.dropdown.adminPanel">${A("user.profile.dropdown.adminPanel")}</span>`,e.addEventListener("click",()=>{he.classList.remove("active"),function(){if(!na||!aa)return _a(A("user.profile.restrictedAccess"),A("admin.noAccess"),"error"),void Sa();["home-view","movies-view","series-view","animes-view","doramas-view","genre-results-view","search-results-view","user-profile-page","en-estreno-view","netflix-view","disney-view","hbo-view","prime-view","paramount-view","stats-view","connected-users-view"].forEach(e=>{document.getElementById(e).classList.remove("active")}),Pe.classList.add("active"),Ge.classList.remove("active"),De.forEach(e=>e.classList.remove("active")),De[0].classList.add("active"),document.getElementById("users-section").style.display="block",document.getElementById("admin-messages-section").style.display="none",Ua()}()}),he.appendChild(e);const t=document.createElement("div");t.className="profile-dropdown-item",t.id="management-panel-link",t.innerHTML=`<i class="fas fa-database"></i><span data-translate="user.profile.dropdown.management">${A("user.profile.dropdown.management")}</span>`,t.addEventListener("click",()=>{he.classList.remove("active"),function(){if(!na||!aa)return _a(A("user.profile.restrictedAccess"),A("management.noAccess"),"error"),void Sa();Wa("management"),We.forEach(e=>e.classList.remove("active")),We[0].classList.add("active"),Xe.forEach(e=>e.style.display="none"),Xe[0].style.display="block"}()}),he.appendChild(t);const n=document.createElement("div");n.className="profile-dropdown-item",n.id="stats-panel-link",n.innerHTML=`<i class="fas fa-chart-bar"></i><span data-translate="user.profile.dropdown.stats">${A("user.profile.dropdown.stats")}</span>`,n.addEventListener("click",()=>{he.classList.remove("active"),function(){if(!na||!aa)return _a(A("user.profile.restrictedAccess"),A("stats.noAccess"),"error"),void Sa();fn.classList.remove("active"),hn.classList.remove("active"),En.classList.remove("active"),bn.classList.remove("active"),Ln.classList.remove("active"),wn.classList.remove("active"),In.classList.remove("active"),Ee.classList.remove("active"),Pe.classList.remove("active"),Ge.style.display="none",Tn.classList.remove("active"),$n.classList.remove("active"),Sn.classList.remove("active"),kn.classList.remove("active"),_n.classList.remove("active"),Bn.classList.remove("active"),Cn.classList.remove("active"),xn.classList.add("active"),Ha()}()}),he.appendChild(n);const a=document.createElement("div");a.className="profile-dropdown-item",a.id="connected-users-link",a.innerHTML=`<i class="fas fa-users"></i><span data-translate="user.profile.dropdown.connected">${A("user.profile.dropdown.connected")}</span>`,a.addEventListener("click",()=>{he.classList.remove("active"),function(){if(!na||!aa)return _a(A("user.profile.restrictedAccess"),A("connectedUsers.noAccess"),"error"),void Sa();fn.classList.remove("active"),hn.classList.remove("active"),En.classList.remove("active"),bn.classList.remove("active"),Ln.classList.remove("active"),wn.classList.remove("active"),In.classList.remove("active"),Ee.classList.remove("active"),Pe.classList.remove("active"),Ge.style.display="none",Tn.classList.remove("active"),$n.classList.remove("active"),Sn.classList.remove("active"),kn.classList.remove("active"),_n.classList.remove("active"),Bn.classList.remove("active"),xn.classList.remove("active"),Cn.classList.add("active"),Ga()}()}),he.appendChild(a),Ke&&(Ke.style.display="block")}else Ke&&(Ke.style.display="none");const t=document.createElement("div");t.className="profile-dropdown-item",t.id="logout-btn",t.innerHTML=`<i class="fas fa-sign-out-alt"></i><span data-translate="user.profile.dropdown.logout">${A("user.profile.dropdown.logout")}</span>`,t.addEventListener("click",Ba),he.appendChild(t)}else{fe.innerHTML='<i class="fas fa-sign-in-alt"></i>',fe.title=A("auth.loginTitle");const e=document.createElement("div");e.className="profile-dropdown-item",e.id="show-login-dropdown",e.innerHTML=`<i class="fas fa-sign-in-alt"></i><span data-translate="user.profile.dropdown.login">${A("user.profile.dropdown.login")}</span>`,e.addEventListener("click",()=>{he.classList.remove("active"),Sa(),q.style.display="block",R.style.display="none"}),he.appendChild(e);const t=document.createElement("div");t.className="profile-dropdown-item",t.id="show-register-dropdown",t.innerHTML=`<i class="fas fa-user-plus"></i><span data-translate="user.profile.dropdown.register">${A("user.profile.dropdown.register")}</span>`,t.addEventListener("click",()=>{he.classList.remove("active"),Sa(),q.style.display="none",R.style.display="block"}),he.appendChild(t)}}function Sa(){H.style.display="flex",q.style.display="block",R.style.display="none",j.reset(),O.reset(),X.style.display="none",Z.style.display="none",Q.style.display="none"}function ka(){H.style.display="none"}function _a(e,t,n="info"){Gt.textContent=e,Yt.textContent=t,zt.className=`modal-overlay ${n}`,zt.style.display="flex";const a=()=>{zt.style.display="none",zt.className="modal-overlay",Xt.removeEventListener("click",a),Wt.removeEventListener("click",a),zt.querySelector(".modal-overlay").removeEventListener("click",a)};Xt.addEventListener("click",a),Wt.addEventListener("click",a),zt.querySelector(".modal-overlay").addEventListener("click",a)}async function Ba(){try{Object.values(sa).forEach(e=>{"function"==typeof e&&e()}),sa={},await r(_),na=null,aa=!1,$a(),Ee.classList.remove("active"),Pe.classList.remove("active"),xn.classList.remove("active"),Cn.classList.remove("active"),Ge.style.display="none",j.reset(),O.reset(),X.style.display="none",Z.style.display="none",Q.style.display="none",Wa("home")}catch(e){console.error("Error signing out:",e)}}async function xa(){if(na)try{const e=await p(g(B,"users",na.id));if(e.exists()&&e.data().myList&&e.data().myList.length>0){let t=e.data().myList;t.sort((e,t)=>(t.lastVisited||0)-(e.lastVisited||0)),await Xa(t,_e,document.getElementById("load-more-my-list"))}else _e.innerHTML=`\n                <div class="empty-state">\n                    <i class="fas fa-list-alt empty-icon"></i>\n                    <h3 class="empty-title">${A("user.profile.myList.emptyTitle")}</h3>\n                    <p class="empty-text">${A("user.profile.myList.emptyText")}</p>\n                </div>`,document.getElementById("load-more-my-list").parentElement.style.display="none"}catch(e){console.error("Error loading user's my list:",e),_e.innerHTML=`<div class="empty-state error">${A("user.profile.myList.loadError")}</div>`}}function Ca(){if(na)try{sa[na.id]&&sa[na.id](),Be.innerHTML=`\n      <div class="message-item" style="text-align: center;">\n        <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto;"></div>\n        <p style="margin-top: 10px;">${A("user.messages.loading")}</p>\n      </div>\n    `,xe.style.display="none";const e=f(c(B,"messages"),h("to","in",[na.id,"all"]),E("date","desc")),t=w(e,e=>{const t=[];if(e.forEach(e=>{t.push({id:e.id,...e.data()})}),t.length>0){xe.style.display="none",Be.innerHTML="",t.forEach(e=>{const t=e.date instanceof Date?e.date:e.date?.toDate?.()||new Date,n=document.createElement("div");n.className="message-item";const a=e.from===na.id||aa;if(n.innerHTML=`\n            <div class="message-header">\n              <span class="message-sender">${"admin"===e.from?A("user.messages.sender.admin"):e.from===na.id?A("user.messages.sender.you"):A("user.messages.sender.system")}</span>\n              <span class="message-date">${t.toLocaleString()}</span>\n            </div>\n            <div class="message-content">${e.content}</div>\n            ${a?`\n              <div class="message-actions">\n                <button class="message-delete-btn" data-id="${e.id}">\n                  <i class="fas fa-trash"></i>\n                </button>\n              </div>\n            `:""}\n          `,Be.appendChild(n),a){n.querySelector(".message-delete-btn").addEventListener("click",()=>{Pa(e.id)})}});Aa(t.filter(e=>"admin"===e.from&&!e.read).length)}else xe.style.display="block",Be.innerHTML="",Aa(0)},e=>{console.error("Error loading user's messages:",e),xe.style.display="none",Be.innerHTML=`\n        <div class="empty-state">\n          <i class="fas fa-exclamation-circle empty-icon"></i>\n          <h3 class="empty-title">${A("user.messages.loadError")}</h3>\n          <p class="empty-text">${A("user.messages.loadError")}</p>\n        </div>\n      `,Aa(0)});sa[na.id]=t}catch(e){console.error("Error setting up message listener:",e),xe.style.display="none",Be.innerHTML=`\n      <div class="empty-state">\n        <i class="fas fa-exclamation-circle empty-icon"></i>\n        <h3 class="empty-title">${A("user.messages.loadError")}</h3>\n        <p class="empty-text">${A("user.messages.loadError")}</p>\n      </div>\n    `,Aa(0)}}function Aa(e){const t=document.getElementById("profile-icon"),n=t.querySelector(".notification-badge");if(n&&n.remove(),e>0){const n=document.createElement("div");n.className="notification-badge",n.textContent=e>9?"9+":e,t.appendChild(n)}}async function Ma(){if(!na||aa)return Me.disabled=!1,Ae.value="",Ne.textContent=A("user.messages.adminNoLimit"),void(Ne.className="message-limit-info");try{const e=await p(g(B,"users",na.id));if(e.exists()){const t=e.data().messagesSent||[],n=new Date;n.setHours(0,0,0,0);const a=t.filter(e=>{const t=e.date instanceof Date?e.date:e.date?.toDate?.()||new Date,a=new Date(t);return a.setHours(0,0,0,0),a.getTime()===n.getTime()});a.length>=2?(Me.disabled=!0,Ne.textContent=A("user.messages.messageLimit.limitReached"),Ne.className="message-limit-info message-limit-warning"):(Me.disabled=!1,Ne.textContent=A("user.messages.messageLimit.canSend",{count:2-a.length}),Ne.className="message-limit-info")}}catch(e){console.error("Error checking message limit:",e),Me.disabled=!1,Ne.textContent=A("user.messages.messageLimit.error"),Ne.className="message-limit-info"}}async function Na(){if(!na)return _a(A("user.profile.restrictedAccess"),A("user.profile.loginRequired"),"info"),void Sa();const e=Ae.value.trim();if(e)try{Me.textContent=A("user.messages.sending"),Me.disabled=!0;const t=new Date,n=await m(c(B,"messages"),{from:na.id,to:"admin",content:e,date:L(),read:!1,userName:na.name}),a=g(B,"users",na.id),s=await p(a);if(s.exists()){const e=s.data().messagesSent||[];e.push({id:n.id,date:t}),await v(a,{messagesSent:e})}Ae.value="",Me.textContent=A("user.messages.sendMessage"),Ma(),_a(A("user.messages.sendSuccess"),A("user.messages.sendSuccess"),"success")}catch(e){console.error("Error sending user message:",e),_a(A("user.messages.sendError.general"),A("user.messages.sendError.general"),"error"),Me.textContent=A("user.messages.sendMessage"),Me.disabled=!1}else _a(A("user.messages.sendError.noMessage"),A("user.messages.sendError.noMessage"),"error")}function Pa(e){Dt.value=e,Pt.style.display="block"}async function Da(){const e=Dt.value;try{if(await T(g(B,"messages",e)),!aa){const t=g(B,"users",na.id),n=await p(t);if(n.exists()){let a=n.data().messagesSent||[];a=a.filter(t=>t.id!==e),await v(t,{messagesSent:a}),Ma()}}Pt.style.display="none",_a(A("user.messages.deleteSuccess"),A("user.messages.deleteSuccess"),"success")}catch(e){console.error("Error deleting message:",e),_a(A("user.messages.deleteError"),A("user.messages.deleteError"),"error")}}async function Ha(){fs();try{const e=f(c(B,"posterClicks"),E("clickCount","desc")),t=await u(e),n=[];let a=1;t.forEach(e=>{n.push({id:e.id,position:a++,...e.data()})}),function(e){if(qn.innerHTML="",0===e.length)return void(qn.innerHTML=`\n      <div class="empty-state" style="grid-column: 1 / -1;">\n        <i class="fas fa-chart-bar empty-icon"></i>\n        <h3 class="empty-title">${A("stats.empty.title")}</h3>\n        <p class="empty-text">${A("stats.empty.text")}</p>\n      </div>\n    `);e.forEach(e=>{const t=document.createElement("div");t.className="stats-card",t.dataset.id=e.posterId,t.dataset.type=e.mediaType;const n=e.posterPath?`${P}/w300${e.posterPath}`:"https://via.placeholder.com/300x450?text=No+Image",a=e.title||A("content.noTitle"),s="movie"===e.mediaType?A("content.type.movie"):A("content.type.series");t.innerHTML=`\n      <img src="${n}" alt="${a}" class="stats-poster">\n      <div class="stats-position">${e.position}</div>\n      <div class="stats-click-count">${e.clickCount} Clicks</div>\n      <div class="stats-info">\n        <h3 class="stats-title">${a}</h3>\n        <div class="stats-meta">\n          <span>${s}</span>\n        </div>\n      </div>\n      <div class="stats-actions">\n        <button class="stats-btn play-btn" title="${A("actions.watchNow")}">\n          <i class="fas fa-play"></i>\n        </button>\n        <button class="stats-btn info-btn" title="${A("actions.info")}">\n          <i class="fas fa-info"></i>\n        </button>\n      </div>\n    `,t.querySelector(".play-btn").addEventListener("click",t=>{t.stopPropagation(),window.open(`go:${e.posterId}`,"_blank")}),t.querySelector(".info-btn").addEventListener("click",t=>{t.stopPropagation(),Ss(e.posterId,e.mediaType)}),t.addEventListener("click",()=>{window.open(`go:${e.posterId}`,"_blank")}),qn.appendChild(t)}),Hs()}(n)}catch(e){console.error("Error loading stats content:",e),qn.innerHTML=`\n      <div class="empty-state" style="grid-column: 1 / -1;">\n        <i class="fas fa-exclamation-circle empty-icon"></i>\n        <h3 class="empty-title">${A("stats.loadError.title")}</h3>\n        <p class="empty-text">${A("stats.loadError.text")}</p>\n      </div>\n    `}finally{hs()}}async function Ua(){if(aa){fs();try{if(0===ia.length){const e=await u(c(B,"users"));ia=e.docs.map(e=>({id:e.id,...e.data()}))}Ve.textContent=ia.length;const e=new Date(Date.now()-36e5),t=ia.filter(t=>(t.lastActivity?.toDate?.()||new Date(0))>e);Fe.textContent=t.length,qa()}catch(e){console.error("Error loading users:",e),Ue.innerHTML=`<div class="empty-state error">${A("admin.loadUsersError")}</div>`}finally{hs()}}}function qa(){const e=ze.value.toLowerCase().trim();va=ia.filter(t=>{const n=t.name?t.name.toLowerCase():"",a=t.email?t.email.toLowerCase():"";return n.includes(e)||a.includes(e)}),ga=1,Ue.innerHTML="",Ra()}function Ra(){if(ya)return;ya=!0;const e=30*(ga-1),t=e+30;!function(e,t=!1){t||(Ue.innerHTML="");e.forEach(e=>{const t=e.registeredAt instanceof Date?e.registeredAt:e.registeredAt?.toDate?.()||new Date,n=e.lastActivity instanceof Date?e.lastActivity:e.lastActivity?.toDate?.()||null,a=n?n.toLocaleString():A("admin.never"),s=document.createElement("div");s.className="user-card",s.innerHTML=`\n      <div class="user-card-header">\n        <div class="user-card-avatar">${e.name.charAt(0).toUpperCase()}</div>\n        <div class="user-card-info">\n          <h4>${e.name}</h4>\n          <p>${e.email}</p>\n        </div>\n      </div>\n      <div class="user-card-body">\n        <p><strong>${A("admin.registeredLabel")}</strong> ${t.toLocaleDateString()}</p>\n        <p><strong>${A("admin.lastActivityLabel")}</strong> ${a}</p>\n      </div>\n      <div class="user-card-actions">\n        <button class="admin-action-btn edit" data-id="${e.id}">${A("actions.edit")}</button>\n        <button class="admin-action-btn message" data-id="${e.id}" data-name="${e.name}">${A("actions.message")}</button>\n        <button class="admin-action-btn delete" data-id="${e.id}">${A("actions.delete")}</button>\n      </div>\n    `,Ue.appendChild(s)}),Ue.querySelectorAll(".edit").forEach(e=>{e.addEventListener("click",()=>{!async function(e){try{const t=await p(g(B,"users",e));if(t.exists()){const n=t.data();ft.value=n.name,ht.value=n.email,Et.value=e,vt.style.display="block"}}catch(e){console.error("Error getting user data for edit:",e),_a(A("modal.errorTitle"),A("modal.loadUserError"),"error")}}(e.dataset.id)})}),Ue.querySelectorAll(".message").forEach(e=>{e.addEventListener("click",()=>{Oa(e.dataset.id,e.dataset.name)})}),Ue.querySelectorAll(".delete").forEach(e=>{e.addEventListener("click",()=>{!function(e){Ct.value=e,xt.style.display="block"}(e.dataset.id)})})}(va.slice(e,t),!0),ga++;const n=document.getElementById("load-more-users");n&&(t>=va.length?n.parentElement.style.display="none":n.parentElement.style.display="block"),0===va.length&&0===e&&(Ue.innerHTML=`<div class="empty-state">${A("admin.noUsersFound")}</div>`),ya=!1}async function ja(){const e=Et.value,t=ft.value.trim(),n=ht.value.trim();if(t&&n)try{await v(g(B,"users",e),{name:t,email:n}),vt.style.display="none",ia=[],Ua(),_a(A("modal.updateSuccessTitle"),A("modal.updateSuccessText"),"success")}catch(e){console.error("Error updating user:",e),_a(A("modal.updateErrorTitle"),A("modal.updateErrorText"),"error")}else _a(A("modal.validationErrorTitle"),A("modal.validationErrorText"),"error")}function Oa(e,t){Tt.value=t,St.value=e,$t.value="",It.style.display="block"}async function Va(){const e=St.value,t=$t.value.trim();if(t)try{Bt.textContent=A("user.messages.sending"),Bt.disabled=!0,await m(c(B,"messages"),{from:"admin",to:e,content:t,date:L(),read:!1}),It.style.display="none",Bt.textContent=A("modal.sendButton"),Bt.disabled=!1,_a(A("user.messages.sendSuccess"),A("user.messages.sendSuccess"),"success")}catch(e){console.error("Error sending message:",e),_a(A("user.messages.sendError.general"),A("user.messages.sendError.general"),"error"),Bt.textContent=A("modal.sendButton"),Bt.disabled=!1}else _a(A("user.messages.sendError.noMessage"),A("user.messages.sendError.noMessage"),"error")}async function Fa(e){e.preventDefault();const t=Re.value,n=je.value.trim();if(n)try{const e=qe.querySelector('button[type="submit"]');e.textContent=A("user.messages.sending"),e.disabled=!0,await m(c(B,"messages"),{from:"admin",to:t,content:n,date:L(),read:!1}),qe.reset(),e.textContent=A("admin.sendMessageButton"),e.disabled=!1,_a(A("user.messages.sendSuccess"),A("user.messages.sendSuccess"),"success")}catch(e){console.error("Error sending message:",e),_a(A("user.messages.sendError.general"),A("user.messages.sendError.general"),"error");const t=qe.querySelector('button[type="submit"]');t.textContent=A("admin.sendMessageButton"),t.disabled=!1}else _a(A("user.messages.sendError.noMessage"),A("user.messages.sendError.noMessage"),"error")}async function za(){const e=Ct.value;try{await T(g(B,"users",e)),xt.style.display="none",ia=[],Ua(),_a(A("modal.deleteUserSuccessTitle"),A("modal.deleteUserSuccessText"),"success")}catch(e){console.error("Error deleting user:",e),_a(A("modal.deleteErrorTitle"),A("modal.deleteErrorText"),"error")}}async function Ga(){fs();try{const e=new Date(Date.now()-3e5),t=f(c(B,"users"),h("lastActivity",">=",e),E("lastActivity","desc")),n=await u(t),a=[];n.forEach(e=>{a.push({id:e.id,...e.data()})}),function(e){if(Rn.innerHTML="",0===e.length)return void(Rn.innerHTML=`\n      <div class="empty-state" style="grid-column: 1 / -1;">\n        <i class="fas fa-users-slash empty-icon"></i>\n        <h3 class="empty-title">${A("connectedUsers.empty.title")}</h3>\n        <p class="empty-text">${A("connectedUsers.empty.text")}</p>\n      </div>\n    `);e.forEach(e=>{const t=e.lastActivity instanceof Date?e.lastActivity:e.lastActivity?.toDate?.()||null,n=t?`${A("admin.lastActivityLabel")} ${t.toLocaleTimeString()}`:`${A("admin.lastActivityLabel")} ${A("admin.notAvailable")}`,a=document.createElement("div");a.className="user-card",a.innerHTML=`\n      <div class="user-card-header">\n        <div class="user-card-avatar">${e.name.charAt(0).toUpperCase()}</div>\n        <div class="user-card-info">\n          <h4>${e.name}</h4>\n          <p>${e.email}</p>\n        </div>\n      </div>\n      <div class="user-card-body">\n        <p><strong>${A("admin.statusLabel")}</strong> <span style="color: var(--success-color); font-weight: bold;">${A("admin.statusConnected")}</span></p>\n        <p>${n}</p>\n      </div>\n    `,Rn.appendChild(a)})}(a)}catch(e){console.error("Error loading connected users:",e),Rn.innerHTML=`\n      <div class="empty-state" style="grid-column: 1 / -1;">\n        <i class="fas fa-exclamation-circle empty-icon"></i>\n        <h3 class="empty-title">${A("connectedUsers.loadError.title")}</h3>\n        <p class="empty-text">${A("connectedUsers.loadError.text")}</p>\n      </div>\n    `}finally{hs()}}function Ya(){zn=null,de.forEach(e=>e.classList.remove("active")),Wa("home"),ve.style.display="none"}async function Wa(e){if(Jn===e&&"home"!==e)return;let t;switch(document.querySelectorAll(".page-view").forEach(e=>e.classList.remove("active")),sn.forEach(e=>e.classList.remove("active")),on.forEach(e=>e.classList.remove("active")),document.querySelectorAll(".load-more-container").forEach(e=>e.style.display="none"),la&&(window.removeEventListener("scroll",la),la=null),e){case"home":t=fn,fn.innerHTML.trim()||await Ja();break;case"movies":t=hn,document.querySelector('.nav-link[data-section="movies"]').classList.add("active"),document.querySelector('.bottom-nav-item[data-section="movies"]').classList.add("active");const n=Wn.filter(e=>e.display_options?.main_sections?.includes("movies"));await Xa(n,An,document.getElementById("load-more-movies")),Za(An,Qa);break;case"series":t=En,document.querySelector('.nav-link[data-section="series"]').classList.add("active"),document.querySelector('.bottom-nav-item[data-section="series"]').classList.add("active");const a=Wn.filter(e=>e.display_options?.main_sections?.includes("series"));await Xa(a,Mn,document.getElementById("load-more-series")),Za(Mn,Qa);break;case"animes":t=bn,document.querySelector('.nav-link[data-section="animes"]').classList.add("active"),document.querySelector('.bottom-nav-item[data-section="animes"]').classList.add("active");const s=Wn.filter(e=>e.display_options?.main_sections?.includes("animes"));await Xa(s,Nn,document.getElementById("load-more-animes")),Za(Nn,Qa);break;case"doramas":t=Ln,document.querySelector('.nav-link[data-section="doramas"]').classList.add("active");const o=Wn.filter(e=>e.display_options?.main_sections?.includes("doramas"));await Xa(o,Pn,document.getElementById("load-more-doramas")),Za(Pn,Qa);break;case"en-estreno":t=Tn;const i=Wn.filter(e=>e.display_options?.home_sections?.includes("estreno")).sort((e,t)=>new Date(t.release_date)-new Date(e.release_date));await Xa(i,Un,document.getElementById("load-more-en-estreno")),Za(Un,Qa);break;case"genre-results":t=wn,Za(Dn,Qa);break;case"search-results":t=In,Za(Hn,Qa);break;case"netflix":case"disney":case"hbo":case"prime":case"paramount":t=document.getElementById(`${e}-view`);const r=document.getElementById(`${e}-grid`),d=document.getElementById(`load-more-${e}`);if(t&&r&&d){const t=Wn.filter(t=>t.display_options?.platforms?.includes(e));await Xa(t,r,d),Za(r,Qa)}break;case"stats":t=xn,Ha();break;case"connected-users":t=Cn,Ga();break;case"management":t=Ge;break;default:t=fn,document.querySelector('.nav-link[data-section="home"]').classList.add("active"),document.querySelector('.bottom-nav-item[data-section="home"]').classList.add("active")}t&&t.classList.add("active"),Jn=e,gs()}async function Xa(e,t,n){t?(fs(),ua=Ds(e),pa=t,pa.innerHTML="",ca=1,n&&n.parentElement&&(n.parentElement.style.display="none"),await Qa(),hs()):console.error("Content pagination setup failed: grid element not found.")}function Za(e,t){la&&(window.removeEventListener("scroll",la),la=null),la=ns(()=>{const{scrollTop:e,scrollHeight:n,clientHeight:a}=document.documentElement;e+a>=n-500&&t()},100),window.addEventListener("scroll",la)}async function Qa(){if(ma)return;ma=!0;const e=30*(ca-1),t=e+30,n=ua.slice(e,t);n.length>0&&(await async function(e,t,n=!0){n&&(e.innerHTML="");const a=await Ls(t);if(0===a.length&&n){const t=document.createElement("div");return t.className="empty-state",t.innerHTML=`\n      <i class="fas fa-film empty-icon"></i>\n      <h3 class="empty-title">${A("content.emptyState.title")}</h3>\n      <p class="empty-text">${A("content.emptyState.text")}</p>\n    `,void e.appendChild(t)}a.forEach(t=>{const n=document.createElement("div");n.className="grid-card",n.dataset.id=t.id,n.dataset.type=t.media_type;const a=t.poster_path?`${P}/w300${t.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",s="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzIDQiPjxyZWN0IHdpZHRoPSIzIiBoZWlnaHQ9IjQiIGZpbGw9IiMzMzMiLz48L2Z2Zz4=",o=t.title||t.name||A("content.noTitle"),i=(t.release_date||t.first_air_date||"").split("-")[0]||A("content.notAvailable"),r=t.vote_average?t.vote_average.toFixed(1):A("content.notAvailable"),d="movie"===t.media_type?A("content.type.movie"):A("content.type.series");n.innerHTML=`\n      <img \n        src="${s}" \n        data-src="${a}" \n        alt="${o}" \n        class="grid-poster lazy"\n        loading="lazy"\n      >\n      <div class="grid-rating">${r}</div>\n      <div class="grid-badge">${d}</div>\n      <div class="grid-info">\n        <h3 class="grid-title">${o}</h3>\n        <div class="grid-meta">\n          <span>${i}</span>\n          <span>${d}</span>\n        </div>\n      </div>\n      <div class="grid-actions">\n        <button class="grid-btn play-btn" title="${A("actions.watchNow")}">\n          <i class="fas fa-play"></i>\n        </button>\n        <button class="grid-btn info-btn" title="${A("actions.info")}">\n          <i class="fas fa-info"></i>\n        </button>\n        ${"profile-my-list-grid"===e.id?`\n          <button class="grid-btn remove-btn" title="${A("actions.removeFromList")}">\n            <i class="fas fa-times"></i>\n          </button>\n        `:""}\n      </div>\n    `,n.querySelector(".play-btn").addEventListener("click",e=>{e.stopPropagation(),Ss(t.id,t.media_type)}),n.querySelector(".info-btn").addEventListener("click",e=>{e.stopPropagation(),Ss(t.id,t.media_type)}),"profile-my-list-grid"===e.id&&n.querySelector(".remove-btn").addEventListener("click",e=>{e.stopPropagation(),async function(e){if(!na)return;try{const t=await p(g(B,"users",na.id));if(t.exists()){let n=t.data().myList||[];n=n.filter(t=>t.id!==e),await v(g(B,"users",na.id),{myList:n})}}catch(e){console.error("Error removing from my list:",e),showToast(A("toast.removeFromListError"),"error")}}(t.id),n.remove()}),n.addEventListener("click",()=>{Ss(t.id,t.media_type)}),e.appendChild(n)}),Hs()}(pa,n,!1),ca++),0===ua.length&&0===e&&(pa.innerHTML=`<div class="empty-state">${A("content.noContent")}</div>`),ma=!1}async function Ka(){try{fs(),Wn=await async function(e={}){const{mediaType:t,limitNumber:n,orderByField:a="imported_at",orderByDirection:s="desc",arrayContains:o}=e;try{let e=c(B,"content");const i=[];t&&i.push(h("media_type","==",t)),o&&o.field&&o.value&&i.push(h(o.field,"array-contains",o.value)),i.push(E(a,s)),n&&i.push(b(n));const r=f(e,...i);return(await u(r)).docs.map(e=>e.data())}catch(e){return console.error("Error fetching content from Firestore:",e),"failed-precondition"===e.code&&console.error("This error may be caused by a missing composite index in Firestore. Please check the Firebase console to create the required index based on the error message."),[]}}(),Zn=Wn.filter(e=>"movie"===e.media_type),Qn=Wn.filter(e=>"tv"===e.media_type);const e=await ws();ss(e),function(e){if(!e||0===e.length)return;e.slice(0,3).forEach(e=>{if(e.backdrop_path){const t=document.createElement("link");t.rel="preload",t.as="image",t.href=`${P}/original${e.backdrop_path}`,document.head.appendChild(t)}if(e.poster_path){const t=document.createElement("link");t.rel="preload",t.as="image",t.href=`${P}/w300${e.poster_path}`,document.head.appendChild(t)}})}(e),Ja(),function(){const e=document.getElementById("categories-container");e.innerHTML="";D.filter(e=>Fn.visibleCategories.includes(String(e.genreId))).forEach(t=>{const n=A(t.key),a=document.createElement("div");a.className="category-item",a.dataset.genre=t.genreId,a.dataset.name=n,a.innerHTML=`\n            <div class="category-icon-wrapper">\n                <i class="${t.icon} category-icon"></i>\n            </div>\n            <span class="category-name">${n}</span>\n        `,e.appendChild(a),a.addEventListener("click",ms)})}(),function(){const e=document.getElementById("streaming-services");e.querySelectorAll(".service-item").forEach(e=>{Fn.visiblePlatforms.includes(e.dataset.service)?e.style.display="":e.style.display="none"})}(),is()}catch(e){console.error("Error loading initial content:",e)}finally{hs()}}async function Ja(){try{const{enEstreno:e,recienAgregado:t,peliculasPopulares:n,seriesPopulares:a}=Fn.homepageSections,s=Wn.filter(e=>e.display_options?.home_sections?.includes("estreno")).sort((e,t)=>new Date(t.release_date)-new Date(e.release_date));await ts(ce,s.slice(0,e));const o=Wn.filter(e=>e.display_options?.home_sections?.includes("agregado")).sort((e,t)=>(t.imported_at?.seconds||0)-(e.imported_at?.seconds||0));if(await ts(document.getElementById("recently-added-slider"),o.slice(0,t)),na){const e=await async function(){try{const e=f(c(B,"posterClicks"),E("clickCount","desc"),b(10)),t=await u(e),n=[];return t.forEach(e=>{n.push(e.data())}),Xn=n,n}catch(e){return console.error("Error fetching trending posters from Firebase:",e),[]}}();await ts(me,e)}else{const e=Ds(Wn).slice(0,10).map(e=>({posterId:e.id,mediaType:e.media_type,title:e.title||e.name,posterPath:e.poster_path,vote_average:e.vote_average,release_date:e.release_date||e.first_air_date}));await ts(me,e)}await ts(ue,Ds(Zn).slice(0,n)),await ts(pe,Ds(Qn).slice(0,a)),await async function(){const e=document.getElementById("dynamic-sections-container");e.innerHTML="";try{const t=(await u(f(c(B,"home_sections"),E("order")))).docs.map(e=>({id:e.id,...e.data()}));for(const n of t){const t=document.createElement("section");switch(t.className="content-row",n.type){case"category":const a=Wn.filter(e=>e.genres?.includes(parseInt(n.options.categoryId)));t.innerHTML=`\n            <div class="row-header">\n              <h2 class="section-title">${n.title}</h2>\n            </div>\n            <div class="content-slider">\n              <div class="slider-container" id="slider-${n.id}"></div>\n              <div class="slider-controls">\n                <button class="slider-arrow slider-prev" aria-label="Anterior"><i class="fas fa-chevron-left"></i></button>\n                <button class="slider-arrow slider-next" aria-label="Siguiente"><i class="fas fa-chevron-right"></i></button>\n              </div>\n            </div>`,e.appendChild(t),await ts(document.getElementById(`slider-${n.id}`),Ds(a).slice(0,20));break;case"single_image":t.innerHTML=`\n        <div class="row-header">\n            <h2 class="section-title">${n.title}</h2>\n        </div>\n        <div class="image-carousel-section">\n            <div class="image-carousel-container" id="carousel-${n.id}">\n            ${n.options.images.map(e=>`\n                <div class="image-carousel-slide" data-link-type="${e.linkType}" data-link-id="${e.linkId}" data-embed-url="${e.embedUrl||""}">\n                <img src="${e.imageUrl}" alt="${n.title}">\n                </div>\n            `).join("")}\n            </div>\n            <div class="image-carousel-controls">\n            <button class="carousel-arrow prev"><i class="fas fa-chevron-left"></i></button>\n            <button class="carousel-arrow next"><i class="fas fa-chevron-right"></i></button>\n            </div>\n        </div>`,e.appendChild(t),es(t.querySelector(".image-carousel-section"));break;case"view":const s=Wn.filter(e=>e.display_options?.main_sections?.includes(n.options.view));t.innerHTML=`\n            <div class="row-header">\n              <h2 class="section-title">${n.title}</h2>\n              <a href="#" class="see-all" data-view="${n.options.view}">${A("home.seeAll")} <i class="fas fa-chevron-right"></i></a>\n            </div>\n            <div class="content-slider">\n              <div class="slider-container" id="slider-${n.id}"></div>\n              <div class="slider-controls">\n                <button class="slider-arrow slider-prev" aria-label="Anterior"><i class="fas fa-chevron-left"></i></button>\n                <button class="slider-arrow slider-next" aria-label="Siguiente"><i class="fas fa-chevron-right"></i></button>\n              </div>\n            </div>`,e.appendChild(t),await ts(document.getElementById(`slider-${n.id}`),Ds(s).slice(0,20));break;case"ad_script":const o=document.createElement("div");o.className="ad-script-section";const i=document.createElement("iframe");i.style.border="none",i.style.width="100%",i.style.height="0",i.setAttribute("scrolling","no"),i.srcdoc=`\n            <html>\n              <head><style>body { margin: 0; overflow: hidden; }</style></head>\n              <body>${n.options.script}</body>\n            </html>\n          `,o.appendChild(i),t.appendChild(o),e.appendChild(t),i.addEventListener("load",()=>{try{const e=i.contentWindow.document.body,t=i.contentWindow.document.documentElement;setTimeout(()=>{const n=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight);i.style.height=n+"px"},100)}catch(e){console.warn("Could not resize ad iframe, likely due to cross-origin restrictions.",e)}});break;case"ad_video":if(sessionStorage.getItem("videoAdShown"))break;sessionStorage.setItem("videoAdShown","true");const r=document.createElement("div");r.className="ad-video-popup";if(n.options.videoUrl.endsWith(".mp4")||n.options.videoUrl.endsWith(".webm")){r.innerHTML=`\n              <video autoplay muted loop playsinline src="${n.options.videoUrl}"></video>\n              <button class="close-ad-btn">√ó</button>\n              <button class="mute-ad-btn"><i class="fas fa-bell-slash"></i></button>\n            `;const e=r.querySelector("video"),t=r.querySelector(".mute-ad-btn");t.addEventListener("click",()=>{e.muted=!e.muted,t.innerHTML=e.muted?'<i class="fas fa-bell-slash"></i>':'<i class="fas fa-bell"></i>'})}else r.innerHTML=`\n              <iframe src="${n.options.videoUrl}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>\n              <button class="close-ad-btn">√ó</button>\n            `;document.body.appendChild(r),r.querySelector(".close-ad-btn").addEventListener("click",()=>{r.remove()})}}document.querySelectorAll(".single-image-section").forEach(e=>{e.addEventListener("click",()=>{const{linkType:t,linkId:n}=e.dataset;"movie"===t||"series"===t?Ss(n,t):"view"===t&&Wa(n)})}),document.querySelectorAll(".see-all[data-view]").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),Wa(e.dataset.view)})}),document.querySelectorAll(".slider-arrow.slider-prev").forEach(e=>{e.addEventListener("click",function(){os(this.closest(".content-slider").querySelector(".slider-container"),"prev")})}),document.querySelectorAll(".slider-arrow.slider-next").forEach(e=>{e.addEventListener("click",function(){os(this.closest(".content-slider").querySelector(".slider-container"),"next")})})}catch(e){console.error("Error rendering dynamic sections:",e)}}()}catch(e){console.error("Error loading deferred content:",e)}}function es(e){const t=e.querySelector(".image-carousel-container");if(!t)return;const n=t.querySelectorAll(".image-carousel-slide"),a=n.length;if(a>1){const e=n[0].cloneNode(!0),s=n[a-1].cloneNode(!0);t.appendChild(e),t.insertBefore(s,n[0])}const s=t.querySelectorAll(".image-carousel-slide");let o,i=a>1?1:0,r=0,d=0,l=!1;const c=(e=!0)=>{t.style.transition=e?"transform 0.5s ease-in-out":"none",t.style.transform=`translateX(-${100*i}%)`},m=()=>{i>=a+1||(i++,c())},u=()=>{i<=0||(i--,c())},p=()=>{g(),a>1&&(o=setInterval(m,5e3))},g=()=>{clearInterval(o)};t.addEventListener("transitionend",()=>{0===i?(i=a,c(!1)):i===a+1&&(i=1,c(!1))}),c(!1),p(),e.querySelector(".next").addEventListener("click",()=>{m(),p()}),e.querySelector(".prev").addEventListener("click",()=>{u(),p()}),t.addEventListener("touchstart",e=>{r=e.touches[0].clientX,l=!0,t.style.transition="none",g()}),t.addEventListener("touchmove",e=>{if(!l)return;d=e.touches[0].clientX;const n=d-r;t.style.transform=`translateX(calc(-${100*i}% + ${n}px))`}),t.addEventListener("touchend",()=>{if(!l)return;l=!1;const e=d-r;e>50?u():e<-50?m():c(),p()}),s.forEach(e=>{e.addEventListener("click",()=>{const{linkType:t,linkId:n,embedUrl:a}=e.dataset;if(a){const e=document.getElementById("trailer-modal");document.getElementById("trailer-iframe").src=a,e.style.display="flex"}else n&&("movie"===t||"series"===t?Ss(n,t):"view"===t?Wa(n):"link"===t&&window.open(n,"_blank"))})})}async function ts(e,t){if("trending-slider"===e.id)return void await async function(e,t){e.innerHTML="";const n=await Ls(t);if(0===n.length){const t=document.createElement("div");return t.className="empty-state",t.innerHTML=`\n            <i class="fas fa-chart-line empty-icon"></i>\n            <h3 class="empty-title">${A("trending.empty.title")}</h3>\n            <p class="empty-text">${A("trending.empty.text")}</p>\n        `,void e.appendChild(t)}n.forEach((t,n)=>{const a=document.createElement("div");a.className="trending-card-container";const s=document.createElement("div");s.className="trending-number",s.textContent=n+1;const o=document.createElement("div");o.className="content-card",o.dataset.id=t.posterId,o.dataset.type=t.mediaType;const i=t.posterPath?`${P}/w300${t.posterPath}`:"https://via.placeholder.com/300x450?text=No+Image",r=t.title||t.name||A("content.noTitle"),d=(t.release_date||t.first_air_date||"").split("-")[0]||A("content.notAvailable"),l=t.vote_average?t.vote_average.toFixed(1):A("content.notAvailable"),c="movie"===t.mediaType?A("content.type.movie"):A("content.type.series");o.innerHTML=`\n            <img src="${i}" alt="${r}" class="card-poster">\n            <div class="card-rating">${l}</div>\n            <div class="card-badge">${c}</div>\n            <div class="card-overlay">\n                <h3 class="card-title">${r}</h3>\n                <div class="card-info">\n                    <span>${d}</span>\n                    <span>${c}</span>\n                </div>\n                <div class="card-actions">\n                    <button class="card-btn play-btn" title="${A("actions.watchNow")}">\n                        <i class="fas fa-play"></i>\n                    </button>\n                    <button class="card-btn info-btn" title="${A("actions.info")}">\n                        <i class="fas fa-info"></i>\n                    </button>\n                </div>\n            </div>\n        `,o.querySelector(".play-btn").addEventListener("click",e=>{e.stopPropagation(),Ss(t.posterId,t.mediaType)}),o.querySelector(".info-btn").addEventListener("click",e=>{e.stopPropagation(),Ss(t.posterId,t.mediaType)}),o.addEventListener("click",()=>{Ss(t.posterId,t.mediaType)}),a.appendChild(s),a.appendChild(o),e.appendChild(a)})}(e,t);e.innerHTML="";const n=await Ls(t);if(0===n.length){const t=document.createElement("div");return t.className="empty-state",t.innerHTML=`\n          <i class="fas fa-film empty-icon"></i>\n          <h3 class="empty-title">${A("content.emptyState.title")}</h3>\n          <p class="empty-text">${A("content.emptyState.text")}</p>\n        `,void e.appendChild(t)}n.forEach(t=>{const n=document.createElement("div");n.className="content-card",n.dataset.id=t.id,n.dataset.type=t.media_type;const a=t.poster_path?`${P}/w300${t.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",s=t.title||t.name||A("content.noTitle"),o=(t.release_date||t.first_air_date||"").split("-")[0]||A("content.notAvailable"),i=t.vote_average?t.vote_average.toFixed(1):A("content.notAvailable"),r="movie"===t.media_type?A("content.type.movie"):A("content.type.series");n.innerHTML=`\n          <img src="${a}" alt="${s}" class="card-poster">\n          <div class="card-rating">${i}</div>\n          <div class="card-badge">${r}</div>\n          ${"en-estreno-slider"===e.id?'<div class="card-estreno-diagonal"></div>':""}\n          ${"recently-added-slider"===e.id?`<div class="card-nuevo-pegatina">${A("content.newSticker")}</div>`:""}\n          <div class="card-overlay">\n            <h3 class="card-title">${s}</h3>\n            <div class="card-info">\n              <span>${o}</span>\n              <span>${r}</span>\n            </div>\n            <div class="card-actions">\n              <button class="card-btn play-btn" title="${A("actions.watchNow")}">\n                <i class="fas fa-play"></i>\n              </button>\n              <button class="card-btn info-btn" title="${A("actions.info")}">\n                <i class="fas fa-info"></i>\n              </button>\n              ${"continue-watching-slider"===e.id?`\n                <button class="card-btn remove-btn" title="${A("actions.removeFromList")}">\n                  <i class="fas fa-times"></i>\n                </button>\n              `:""}\n            </div>\n          </div>\n        `,n.querySelector(".play-btn").addEventListener("click",e=>{e.stopPropagation(),Ss(t.id,t.media_type)}),n.querySelector(".info-btn").addEventListener("click",e=>{e.stopPropagation(),Ss(t.id,t.media_type)}),"continue-watching-slider"===e.id&&n.querySelector(".remove-btn").addEventListener("click",e=>{e.stopPropagation(),removeFromContinuarViendo(t.id),n.remove(),0===Kn.length&&(continueWatchingSection.style.display="none")}),n.addEventListener("click",()=>{Ss(t.id,t.media_type)}),e.appendChild(n)})}function ns(e,t=100){let n=0;return function(...a){const s=(new Date).getTime();s-n<t||(n=s,e(...a))}}function as(e,t=300){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>e(...a),t)}}async function ss(e){le.innerHTML="";const t=e.map(async(e,t)=>{const n=0===t?"active":"",a=document.createElement("div");a.className=`hero-slide ${n}`,a.style.backgroundImage=`url('https://image.tmdb.org/t/p/original${e.backdrop_path}')`;const s=e.overview||("movie"===e.media_type?A("hero.movieDescription"):A("hero.seriesDescription")),o="tv"===e.media_type?"SERIE":"PEL√çCULA",i=await fetch(`${N}/${e.media_type}/${e.id}/images?api_key=${S}`),r=await i.json(),d=r.logos.find(e=>e.iso_639_1===Fn.displayLanguage.substring(0,2)),l=r.logos.find(e=>"en"===e.iso_639_1),c=r.logos.find(e=>null===e.iso_639_1),m=d||l||c;let u;u=m?`<img src="${P}/w500${m.file_path}" alt="${e.title||e.name}" class="hero-logo">`:`<h2 class="hero-title">${e.title||e.name}</h2>`,a.innerHTML=`\n          <div class="hero-overlay">\n            <div class="hero-content">\n              <p class="hero-media-type">${o}</p>\n              ${u}\n              <p class="hero-description">${s.substring(0,120)}${s.length>120?"...":""}</p>\n              <div class="hero-buttons">\n                <button class="btn btn-secondary hero-add-list-btn" data-id="${e.id}" data-type="${e.media_type}" title="${A("actions.addToList")}">\n                  <i class="fas fa-plus"></i>${A("actions.list")}\n                </button>\n                <button class="btn btn-primary hero-play-btn" data-id="${e.id}" data-type="${e.media_type}" title="${A("actions.watchNow")}">\n                  <i class="fas fa-play"></i> ${A("actions.watchNow")}\n                </button>\n                <button class="btn btn-secondary hero-info-btn" data-id="${e.id}" data-type="${e.media_type}" title="${A("actions.moreInfo")}">\n                  <i class="fas fa-info-circle"></i> ${A("actions.info")}\n                </button>\n              </div>\n            </div>\n          </div>\n        `;const p=a.querySelector(".hero-play-btn");p&&p.addEventListener("click",t=>{t.stopPropagation(),clearInterval(Vn),Ss(e.id,e.media_type)});const g=a.querySelector(".hero-info-btn");g&&g.addEventListener("click",t=>{t.stopPropagation(),clearInterval(Vn),Ss(e.id,e.media_type)});const y=a.querySelector(".hero-add-list-btn");return y&&y.addEventListener("click",async t=>{t.stopPropagation(),clearInterval(Vn);const n=t.currentTarget;try{await vs(e,n)}catch(e){console.error("Error adding to list:",e),n.innerHTML=`<i class="fas fa-times"></i> ${A("actions.error")}`,setTimeout(()=>{n.innerHTML=`<i class="fas fa-plus"></i>${A("actions.list")}`},2500)}}),a});(await Promise.all(t)).forEach(e=>le.appendChild(e));const n=document.createElement("div");n.className="hero-nav",n.id="hero-nav",e.forEach((e,t)=>{const a=document.createElement("div");a.className="hero-dot "+(0===t?"active":""),a.dataset.index=t,a.addEventListener("click",()=>rs(t,!1)),n.appendChild(a)}),le.appendChild(n),ea=document.querySelectorAll(".hero-slide"),ta=document.querySelectorAll(".hero-dot")}function os(e,t){"prev"===t?e.scrollBy({left:-720,behavior:"smooth"}):e.scrollBy({left:720,behavior:"smooth"})}function is(){clearInterval(Vn),Yn&&(Vn=setInterval(()=>{Yn?rs((Gn+1)%ea.length):clearInterval(Vn)},8e3))}function rs(e,t=!0){ea[Gn].classList.remove("active"),ta[Gn].classList.remove("active"),Gn=e,ea[Gn].dataset.background&&(ea[Gn].style.backgroundImage=ea[Gn].dataset.background,ea[Gn].removeAttribute("data-background")),ea[Gn].classList.add("active"),ta[Gn].classList.add("active"),t||(Yn=!1),is()}function ds(){ae.classList.toggle("active"),ae.classList.contains("active")&&setTimeout(()=>ae.focus(),300)}function ls(){const e=ae.value.trim();if(!e)return;Wa("search-results"),On.textContent=`${A("search.resultsFor")} "${e}"`;const t=cs(e);Xa(Wn.filter(e=>{const n=cs(e.title||e.name||""),a=cs(e.original_title||e.original_name||"");return n.includes(t)||a.includes(t)}),Hn,document.getElementById("load-more-search"))}function cs(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}async function ms(e){const t=parseInt(e.currentTarget.dataset.genre),n=e.currentTarget.dataset.name;Wa("genre-results"),jn.textContent=`${A("genres.genreLabel")}: ${n}`,fs();try{Xa(Wn.filter(e=>e.genres&&e.genres.includes(t)),Dn,document.getElementById("load-more-genre"))}catch(e){console.error("Error filtering genre content:",e),Dn.innerHTML=`<div class="empty-state error">${A("genres.loadError")}</div>`}finally{hs()}}async function us(e){const t=e.currentTarget.dataset.service;de.forEach(e=>e.classList.remove("active")),zn!==t?(e.currentTarget.classList.add("active"),zn=t,Wa(t),ve.style.display="block"):Ya()}function ps(){window.scrollY>300?se.classList.add("visible"):se.classList.remove("visible")}function gs(){window.scrollTo({top:0,behavior:"smooth"})}function ys(){oe.style.display="none",re.checked&&localStorage.setItem("dontShowPopupAgain","true")}async function vs(e,t=null){if(!na)return void Sa();const n=t?t.innerHTML:"";t&&(t.disabled=!0,t.innerHTML=`<i class="fas fa-spinner fa-spin"></i> ${A("actions.saving")}`);try{await Es(e.id,e.media_type,e.title||e.name,e.poster_path,e.vote_average);const n=g(B,"users",na.id),a=await p(n);if(a.exists()){let s=a.data().myList||[];-1===s.findIndex(t=>t.id===e.id&&t.media_type===e.media_type)?(s.push({id:e.id,media_type:e.media_type,title:e.title||e.name,poster_path:e.poster_path,release_date:e.release_date||e.first_air_date,vote_average:e.vote_average,lastVisited:(new Date).toISOString()}),await v(n,{myList:s}),t?t.innerHTML=`<i class="fas fa-check"></i> ${A("actions.added")}`:showToast(A("toast.addedToList"),"success")):t?t.innerHTML=`<i class="fas fa-info-circle"></i> ${A("actions.alreadyInList")}`:showToast(A("toast.alreadyInList"),"info")}}catch(e){console.error("Error saving to my list:",e),t?t.innerHTML=`<i class="fas fa-times"></i> ${A("actions.error")}`:showToast(A("toast.addToListError"),"error")}finally{t&&setTimeout(()=>{t.disabled=!1,t.innerHTML=n},2500)}}function fs(){ee.style.display="flex"}function hs(){ee.style.display="none"}async function Es(e,t,n,a,s){try{const o=g(B,"posterClicks",String(e)),i=await p(o);i.exists()?await v(o,{clickCount:i.data().clickCount+1,lastClicked:L(),mediaType:t,title:n,posterPath:a,vote_average:s}):await y(o,{posterId:String(e),mediaType:t,title:n,posterPath:a,vote_average:s,clickCount:1,lastClicked:L()})}catch(e){console.error("Error updating poster click count:",e)}}async function bs(e,t){if(!e||0===e.length)return[];try{const n=e.map(e=>{const n=`${t}_${e}`;if(x.has(n)){const e=x.get(n);if((new Date).getTime()-e.timestamp<18e5)return e.data}return fetch(`${N}/${t}/${e}?api_key=${S}&language=${Fn.importLanguage}`).then(n=>{if(!n.ok)throw new Error(`Error fetching ${t} ${e}`);return n.json()}).then(e=>(x.set(n,{data:{...e,media_type:t},timestamp:(new Date).getTime()}),{...e,media_type:t})).catch(e=>(console.error(e),null))});return(await Promise.all(n)).filter(e=>null!==e)}catch(e){return console.error(`Error fetching ${t} content:`,e),[]}}async function Ls(e){if("en-US"!==Fn.displayLanguage||!e||0===e.length)return e;const t=e.map(e=>{const t=e.id||e.posterId,n=e.media_type||e.mediaType;if(!t||!n)return Promise.resolve(e);return fetch(`${N}/${n}/${t}?api_key=${S}&language=en-US`).then(a=>a.ok?a.json():(console.warn(`Could not fetch English details for ${n} ${t}. Status: ${a.status}`),e)).then(t=>t&&!1!==t.success?{...e,title:t.title||t.name,name:t.name||t.title,overview:t.overview,poster_path:t.poster_path}:e).catch(a=>(console.error(`Error fetching English details for ${n} ${t}:`,a),e))});try{return await Promise.all(t)}catch(t){return console.error("Failed to translate content to English, returning original content.",t),e}}async function ws(){try{const{posters:e,random:t,recent:n}=Fn.heroSlider,a=f(c(B,"content"),E("imported_at","desc"),b(2*n)),s=(await u(a)).docs.map(e=>e.data()),o=s.filter(e=>e.backdrop_path).slice(0,n),i=o.map(e=>e.id),r=Ds(Wn.filter(e=>e.backdrop_path&&!i.includes(e.id))).slice(0,t);let d=Ds([...o,...r]).slice(0,e);if("en-US"===Fn.displayLanguage){return await async function(e){const t=e.map(e=>{const t=`${N}/${e.media_type}/${e.id}?api_key=${S}&language=en-US`;return fetch(t).then(e=>e.json())});try{const n=await Promise.all(t);return e.map((e,t)=>{const a=n[t];return a&&!1!==a.success?{...e,title:a.title||a.name,name:a.name||a.title,overview:a.overview}:e})}catch(t){return console.error("Failed to fetch hero details in English, falling back to original:",t),e}}(d)}return d}catch(e){console.error("Error generating hero content, using a simple random fallback:",e);return Ds(Wn.filter(e=>e.backdrop_path)).slice(0,Fn.heroSlider.posters)}}function Is(e){const t=document.getElementById("modal-video-container"),n=document.getElementById("video-player-iframe");t&&n&&(n.src=e,t.style.display="block")}function Ts(e){const t=document.getElementById("media-options-container");if(!t)return;if(!e||0===Object.keys(e).length)return void(t.innerHTML=`<p class="empty-text">${A("details.noSeasons")}</p>`);const n=Object.values(e).filter(e=>e.season_number>0&&e.episodes&&Object.keys(e.episodes).length>0).sort((e,t)=>e.season_number-t.season_number);if(0===n.length)return void(t.innerHTML=`<p class="empty-text">${A("details.noSeasons")}</p>`);const a=n[0],s=`\n        <div class="season-selector">\n            <button class="season-select-btn">\n                <span>${A("details.season")} ${a.season_number}</span>\n                <i class="fas fa-chevron-down"></i>\n            </button>\n            <ul class="season-dropdown" style="display: none;">\n                ${n.map(e=>`\n                    <li data-season-number="${e.season_number}">${A("details.season")} ${e.season_number}</li>\n                `).join("")}\n            </ul>\n        </div>\n        <div id="episodes-wrapper">\n             ${$s(a.episodes)}\n        </div>\n    `;t.innerHTML=s,function(e){const t=document.querySelector(".season-select-btn"),n=document.querySelector(".season-dropdown"),a=document.getElementById("episodes-wrapper");if(!t||!n)return;t.addEventListener("click",e=>{e.stopPropagation();const t="block"===n.style.display;n.style.display=t?"none":"block"}),document.addEventListener("click",e=>{t.contains(e.target)||n.contains(e.target)||(n.style.display="none")}),n.querySelectorAll("li").forEach(s=>{s.addEventListener("click",()=>{const o=parseInt(s.dataset.seasonNumber,10),i=e.find(e=>e.season_number===o);i&&(t.querySelector("span").textContent=`${A("details.season")} ${o}`,a.innerHTML=$s(i.episodes),a.querySelectorAll(".episode-item").forEach(e=>{e.addEventListener("click",()=>{e.dataset.url&&(a.querySelectorAll(".episode-item").forEach(e=>e.classList.remove("active")),e.classList.add("active"),Is(e.dataset.url))})})),n.style.display="none"})}),a.querySelectorAll(".episode-item").forEach(e=>{e.addEventListener("click",()=>{e.dataset.url&&(a.querySelectorAll(".episode-item").forEach(e=>e.classList.remove("active")),e.classList.add("active"),Is(e.dataset.url))})})}(n)}function $s(e){if(!e||0===Object.keys(e).length)return`<p class="empty-text" style="font-size: 0.9rem; padding: 10px;">${A("details.noEpisodes")}</p>`;const t=Object.values(e).filter(e=>e.video_url).sort((e,t)=>e.episode_number-t.episode_number);return 0===t.length?`<p class="empty-text" style="font-size: 0.9rem; padding: 10px;">${A("details.noEpisodes")}</p>`:`<ul class="episodes-list">${t.map(e=>`\n        <li class="episode-item" data-url="${e.video_url}">\n            ${e.episode_number}\n        </li>`).join("")}</ul>`}async function Ss(e,t){const n=document.getElementById("movie-details-modal-container");if(!n.querySelector(".movie-details-modal")){n.innerHTML='\n            <div class="movie-details-modal">\n                <div class="modal-overlay"></div>\n                <div class="modal-container">\n                    <div class="modal-content-wrapper"></div>\n                    <button class="modal-close" id="close-details-modal"><i class="fas fa-times"></i></button>\n                </div>\n            </div>';const e=()=>{n.innerHTML="";const e=document.getElementById("video-player-iframe");e&&(e.src="about:blank")};n.querySelector("#close-details-modal").addEventListener("click",e),n.querySelector(".modal-overlay").addEventListener("click",e)}const a=n.querySelector(".modal-content-wrapper");a.innerHTML=`<div class="modal-loading"><div class="spinner"></div><p>${A("modal.loading")}</p></div>`;try{const n=Fn.displayLanguage||"es-MX",a=await fetch(`${N}/${t}/${e}?api_key=${S}&language=${n}&append_to_response=credits`);if(a.ok){const e=await a.json();await Es(e.id,t,e.title||e.name,e.poster_path,e.vote_average),await ks(e,t)}else{const n=g(B,"content",String(e)),a=await p(n);if(!a.exists())throw new Error(A("modal.contentNotFound"));const s=a.data();await Es(s.id,t,s.title||s.name,s.poster_path,s.vote_average),await ks(s,t)}}catch(e){console.error("Error showing movie details:",e),a&&(a.innerHTML=`<div class="modal-error"><h3>${A("modal.errorTitle")}</h3><p>${e.message}</p></div>`)}}async function ks(e,t){const n=document.getElementById("movie-details-modal-container"),a=g(B,"content",String(e.id)),s=await p(a),o=s.exists()?s.data():{},i=e.title||e.name||A("content.noTitle"),r=e.poster_path?`${P}/w300${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",d=e.backdrop_path?`${P}/original${e.backdrop_path}`:"",l=e.overview||A("details.noDescription"),m=e.genres?.map(e=>e.name).join(", ")||A("content.notAvailable");let y=A("content.notAvailable");if(e.credits)if("movie"===t){const t=e.credits.crew.find(e=>"Director"===e.job);t&&(y=t.name)}else"tv"===t&&e.created_by?.length>0&&(y=e.created_by.map(e=>e.name).join(", "));const v=e.credits?.cast.slice(0,6).map(e=>e.name).join(", ")||A("content.notAvailable"),f=o.next_episode_note||"",h=f?`<div class="next-episode-note">\n             <i class="fas fa-info-circle"></i> ${f}\n           </div>`:"";let E=[];E="movie"===t?Ds(Wn.filter(t=>"movie"===t.media_type&&t.id!==e.id)).slice(0,10):Ds(Wn.filter(t=>"tv"===t.media_type&&t.id!==e.id)).slice(0,10);const b=E.slice(0,6),L=E.map(e=>`\n        <div class="grid-card related-card" data-id="${e.id}" data-type="${e.media_type}">\n            <img src="${e.poster_path?`${P}/w300${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image"}" alt="${e.title||e.name}" class="grid-poster">\n                <div class="card-rating">${e.vote_average?e.vote_average.toFixed(1):A("content.notAvailable")}</div>\n        </div>\n    `).join(""),w=b.map(e=>`\n        <div class="grid-card related-card" data-id="${e.id}" data-type="${e.media_type}">\n            <img src="${e.poster_path?`${P}/w300${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image"}" alt="${e.title||e.name}" class="grid-poster">\n                <div class="card-rating">${e.vote_average?e.vote_average.toFixed(1):A("content.notAvailable")}</div>\n        </div>\n    `).join("");let I=`\n        ${d?`<div class="modal-backdrop" style="background-image: url('${d}')"><div class="modal-backdrop-overlay"></div></div>`:""}\n        <div class="modal-content-inner">\n            <div class="modal-main-content">\n                <div id="modal-video-container" class="modal-video-container">\n                    <iframe id="video-player-iframe" width="100%" src="" frameborder="0" allow="autoplay; encrypted-media; picture-in-picture" allowfullscreen></iframe>\n                </div>\n                <div class="related-content-container related-desktop">\n                    <h3 data-translate="details.youMightLike">${A("details.youMightLike")}</h3>\n                    <div class="related-content-grid">\n                        ${L}\n                    </div>\n                </div>\n            </div>\n            <div class="modal-sidebar-content">\n                <div class="modal-header-new">\n                    <div class="modal-poster-new"><img src="${r}" alt="${i}"></div>\n                    <div class="modal-info-new">\n                        <h2 class="modal-title-new">${i}</h2>\n                        <p class="modal-meta-new"><strong data-translate="details.year">${A("details.year")}</strong> ${(e.release_date||e.first_air_date||"").split("-")[0]||A("content.notAvailable")}</p>\n                        <p class="modal-meta-new"><strong data-translate="details.genre">${A("details.genre")}</strong> ${m}</p>\n                        <p class="modal-meta-new"><strong data-translate="${"movie"===t?"details.director":"details.creator"}">${A("movie"===t?"details.director":"details.creator")}:</strong> ${y}</p>\n                        <p class="modal-meta-new"><strong data-translate="details.cast">${A("details.cast")}</strong> ${v}</p>\n                    </div>\n                </div>\n                ${na?`<button class="modal-btn modal-btn-primary" id="modal-add-to-list-btn" style="width: 70%; margin: 15px auto; display: block;"><i class="fas fa-plus"></i> <span data-translate="details.addToMyList">${A("details.addToMyList")}</span></button>`:""}\n                <div id="media-options-container" class="media-options-container"></div>\n                <div class="modal-overview-new">\n                    ${h}\n                    <p>${l}</p>\n                </div>\n            </div>\n            <div class="related-content-container related-mobile">\n                <h3 data-translate="details.youMightLike">${A("details.youMightLike")}</h3>\n                <div class="related-content-grid">\n                    ${w}\n                </div>\n            </div>\n        </div>`;if(n.querySelector(".modal-content-wrapper").innerHTML=I,n.querySelectorAll(".related-card").forEach(e=>{e.addEventListener("click",()=>{Ss(e.dataset.id,e.dataset.type)})}),na){const a=n.querySelector("#modal-add-to-list-btn");a&&a.addEventListener("click",n=>{vs({id:e.id,media_type:t,title:e.title||e.name,poster_path:e.poster_path,release_date:e.release_date||e.first_air_date,vote_average:e.vote_average},n.currentTarget)})}try{const e=(await u(c(B,"modal_sections"))).docs.map(e=>({id:e.id,...e.data()}));e.sort((e,t)=>(e.order||0)-(t.order||0)),e.forEach(e=>{if("ad_script_modal"===e.type&&e.options.script){const t=document.createElement("div");t.className="ad-container";const a=e.options.position,s=n.querySelector(`.${a.replace(/ /g,".")}`);s?(s.parentNode.insertBefore(t,s.nextSibling),function(e,t){e.innerHTML=t;Array.from(e.getElementsByTagName("script")).forEach(e=>{const t=document.createElement("script");Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.text=e.text,e.parentNode.replaceChild(t,e)})}(t,e.options.script)):console.warn(`Target element for ad not found: ${a}`)}})}catch(e){console.error("Error loading modal ad sections:",e)}const T=o.video_url||null,$=o.seasons||null;if("movie"===t)T?Is(T):(document.getElementById("modal-video-container").style.display="none",document.getElementById("media-options-container").innerHTML=`<p class="empty-text">${A("details.videoNotAvailable")}</p>`);else if("tv"===t){Ts($);let e=null;if($&&Object.keys($).length>0){const t=Object.values($).sort((e,t)=>e.season_number-t.season_number);let n=t.find(e=>e.season_number>0&&e.episodes&&Object.keys(e.episodes).length>0)||t.find(e=>e.episodes&&Object.keys(e.episodes).length>0);if(n){const t=Object.values(n.episodes).sort((e,t)=>e.episode_number-t.episode_number);t.length>0&&t[0].video_url&&(e=t[0].video_url)}}e?Is(e):document.getElementById("modal-video-container").style.display="none"}}async function _s(){const e=document.getElementById("tmdb-search-input").value.trim();if(e){fs();try{const t=await fetch(`${N}/search/multi?api_key=${S}&language=${Fn.importLanguage}&query=${encodeURIComponent(e)}`);if(!t.ok)throw new Error(A("tmdb.searchError"));const n=await t.json();!function(e){const t=document.getElementById("tmdb-search-results");if(t.innerHTML="",0===e.length)return void(t.innerHTML=`<p>${A("search.noResults")}</p>`);e.forEach(async e=>{const n=document.createElement("div");n.className="grid-card";const a=`${P}/w300${e.poster_path}`,s=e.title||e.name,o=(e.release_date||e.first_air_date||"").split("-")[0]||A("content.notAvailable"),i="movie"===e.media_type?A("content.type.movie"):A("content.type.series"),r=g(B,"content",String(e.id)),d=(await p(r)).exists();n.innerHTML=`\n      <img src="${a}" alt="${s}" class="grid-poster">\n      <div class="grid-info">\n        <h3 class="grid-title">${s}</h3>\n        <div class="grid-meta">\n          <span>${o}</span>\n          <span>${i}</span>\n        </div>\n      </div>\n      <div class="grid-actions-2">\n        ${d?`<button class="grid-btn delete-btn" style="background-color: var(--error-color);"><i class="fas fa-trash"></i> ${A("actions.delete")}</button>`:`<button class="grid-btn-import import-btn"><i class="fas fa-download"></i> ${A("actions.import")}</button>`}\n      </div>\n    `,d?n.querySelector(".delete-btn").addEventListener("click",()=>{As(e.id)}):n.querySelector(".import-btn").addEventListener("click",()=>{Bs(e)}),t.appendChild(n)})}(n.results.filter(e=>("movie"===e.media_type||"tv"===e.media_type)&&e.poster_path))}catch(e){console.error("Error en la b√∫squeda de TMDB:",e),_a(A("tmdb.searchErrorTitle"),A("tmdb.searchErrorText"),"error")}finally{hs()}}else _a(A("search.emptyQueryTitle"),A("search.emptyQueryText"),"info")}async function Bs(e){if(!aa)return void _a(A("modal.notAuthorizedTitle"),A("modal.notAuthorizedText"),"error");const t=g(B,"content",String(e.id));(await p(t)).exists()?_a(A("modal.duplicateContentTitle"),A("modal.duplicateContentText"),"info"):(ra=!1,oa=e,xs(e))}async function xs(e){const t=ra?da:oa;Kt.innerHTML="",Zt.style.display="flex",tn.textContent=A(ra?"actions.updateUrls":"actions.next");let n=t;if(Qt.textContent=ra?`${A("modal.editUrlsTitle")} ${t.title||t.name}`:`${A("modal.addUrlsTitle")} ${t.title||t.name}`,"movie"===n.media_type){nn.style.display="none";const e=n.video_url||"";Kt.innerHTML=`\n            <div class="form-group">\n                <label for="movie-video-url">${A("modal.videoUrlLabel")}</label>\n                <input type="text" id="movie-video-url" class="form-input" placeholder="https://..." value="${e}">\n            </div>\n        `}else if("tv"===n.media_type){if(nn.style.display="block",Kt.innerHTML='<div class="spinner"></div>',ra){const e=`${N}/tv/${n.id}?api_key=${S}&language=${Fn.importLanguage}`,t=await fetch(e);if(t.ok){const e=await t.json();Array.isArray(da.seasons)?da.seasons=da.seasons.reduce((e,t)=>(t&&t.season_number&&(e[t.season_number]=t),e),{}):da.seasons||(da.seasons={});for(const t of e.seasons){if(0===t.season_number)continue;const e=t.season_number,a=`${N}/tv/${n.id}/season/${e}?api_key=${S}&language=${Fn.importLanguage}`,s=await fetch(a);if(s.ok){const n=await s.json();if(da.seasons[e]||(da.seasons[e]={...t,episodes:{}}),da.seasons[e].episodes||(da.seasons[e].episodes={}),n.episodes)for(const t of n.episodes){const n=t.episode_number;if(!da.seasons[e].episodes[n]){const a=da.seasons[e].episodes[n];da.seasons[e].episodes[n]={...t,video_url:a?.video_url||""}}}}}}n=da}else{const e=`${N}/tv/${n.id}?api_key=${S}&language=${Fn.importLanguage}`,t=await fetch(e);n=await t.json(),n.media_type="tv",oa=n}let e='<div class="seasons-accordion">';const t=(Array.isArray(n.seasons)?n.seasons:Object.values(n.seasons||{}).sort((e,t)=>e.season_number-t.season_number)).filter(e=>0!==e.season_number);for(const n of t){(ra?n.episodes&&Object.keys(n.episodes).length>0:n.episode_count>0)&&(e+=`\n                <div class="accordion-item">\n                    <div class="accordion-header">\n                        <span>${A("details.season")} ${n.season_number}</span>\n                        <i class="fas fa-chevron-down"></i>\n                    </div>\n                    <div class="accordion-content" style="display: none;">\n                        <ul class="episodes-list-form" id="season-${n.season_number}-episodes"><li>${A("modal.loading")}</li></ul>\n                    </div>\n                </div>`)}e+="</div>",Kt.innerHTML=e;for(const e of t){const t=document.getElementById(`season-${e.season_number}-episodes`);if(!t)continue;let a;if(ra)a=Object.values(e.episodes||{}).sort((e,t)=>e.episode_number-t.episode_number);else{const t=`${N}/tv/${n.id}/season/${e.season_number}?api_key=${S}&language=${Fn.importLanguage}`,s=await fetch(t);a=(await s.json()).episodes||[];const o=oa.seasons.find(t=>t.id===e.id);o&&(o.episodes=a)}t.innerHTML="",a.forEach(n=>{const a=n.video_url||"";t.innerHTML+=`\n                    <li>\n                        <label for="video-url-s${e.season_number}-e${n.episode_number}">${A("details.episode")} ${n.episode_number}: ${n.name}</label>\n                        <input type="text" id="video-url-s${e.season_number}-e${n.episode_number}" class="form-input" data-season="${e.season_number}" data-episode="${n.episode_number}" value="${a}" placeholder="https://...">\n                    </li>\n                `})}Kt.querySelectorAll(".accordion-header").forEach(e=>{e.addEventListener("click",()=>{const t=e.nextElementSibling;t.style.display="none"===t.style.display?"block":"none",e.querySelector("i").classList.toggle("fa-chevron-down"),e.querySelector("i").classList.toggle("fa-chevron-up")})})}}async function Cs(){console.log("Refreshing UI based on new data..."),Ja();ss(await ws());if(["movies","series","animes","netflix","disney","hbo","prime","paramount"].includes(Jn)&&Wa(Jn),Pe.classList.contains("active")){const e=document.querySelector(".admin-tab.active")?.dataset.tab;if("manage-content"===e)Us();else if("content"===e){document.getElementById("tmdb-search-input").value.trim()&&_s()}}console.log("UI Refresh complete.")}function As(e){Ft.value=e,Rt.style.display="flex"}async function Ms(e){if(e.preventDefault(),aa){fs();try{const e={importLanguage:et.value,displayLanguage:tt.value,heroSlider:{posters:parseInt(nt.value),random:parseInt(at.value),recent:parseInt(st.value)},visibleCategories:Array.from(document.querySelectorAll('input[name="visible-category"]:checked')).map(e=>e.value),visiblePlatforms:Array.from(document.querySelectorAll('input[name="visible-platform"]:checked')).map(e=>e.value),homepageSections:{enEstreno:parseInt(rt.value),recienAgregado:parseInt(dt.value),peliculasPopulares:parseInt(lt.value),seriesPopulares:parseInt(ct.value)}},t=g(B,"web_config","settings");await y(t,e),Fn=e,await Ka(),M(),$a(),_a(A("settings.saveSuccess"),A("settings.saveSuccess"),"success")}catch(e){console.error("Error saving web settings:",e),_a(A("settings.saveError"),A("settings.saveError"),"error")}finally{hs()}}}async function Ns(){const e=Ft.value;if(e){fs();try{await T(g(B,"content",String(e)));const t=Wn.findIndex(t=>String(t.id)===e);t>-1&&Wn.splice(t,1),Zn=Wn.filter(e=>"movie"===e.media_type),Qn=Wn.filter(e=>"tv"===e.media_type),await Cs(),_a(A("modal.deleteContentSuccessTitle"),A("modal.deleteContentSuccessText"),"success")}catch(e){console.error("Error deleting content:",e),_a(A("modal.deleteContentErrorTitle"),A("modal.deleteContentErrorText"),"error")}finally{hs(),Rt.style.display="none"}}}async function Ps(){if(!aa)return void _a(A("modal.notAuthorizedTitle"),A("modal.notAuthorizedText"),"error");if(confirm(A("modal.seedDbConfirm"))){fs();try{const e=[...seedContentIds.movies,...seedContentIds.series];let t=0,n=0;for(const a of e){const e=seedContentIds.movies.includes(a)?"movie":"tv",s=g(B,"content",String(a));if((await p(s)).exists()){n++;continue}const o=await bs([a],e);o&&o.length>0&&(await Bs(o[0]),t++)}_a(A("modal.seedDbSuccessTitle"),A("modal.seedDbSuccessText",{importedCount:t,skippedCount:n}),"success")}catch(e){console.error("Error poblando la base de datos:",e),_a(A("modal.errorTitle"),A("modal.seedDbError"),"error")}finally{hs()}}}function Ds(e){const t=[...e];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function Hs(){if("IntersectionObserver"in window){const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.dataset.src&&(n.src=n.dataset.src,n.removeAttribute("data-src")),n.classList.add("loaded"),t.unobserve(n)}})},{rootMargin:"200px 0px",threshold:.01});document.querySelectorAll("img.lazy").forEach(t=>{e.observe(t)})}else document.querySelectorAll("img.lazy").forEach(e=>{e.dataset.src&&(e.src=e.dataset.src,e.classList.add("loaded"))})}function Us(){if(aa){fs();try{const e=document.getElementById("manage-content-search-input");e&&(e.value=""),qs()}catch(e){console.error("Error loading all imported content:",e),document.getElementById("manage-content-grid").innerHTML=`<p>${A("content.loadError")}</p>`}finally{hs()}}}function qs(){const e=document.getElementById("manage-content-search-input").value.toLowerCase().trim();Ea=[...Wn].sort((e,t)=>(t.imported_at?.seconds||0)-(e.imported_at?.seconds||0)),e&&(Ea=Ea.filter(t=>(t.title||t.name||"").toLowerCase().includes(e))),fa=1,document.getElementById("manage-content-grid").innerHTML="",Rs()}function Rs(){if(ha)return;ha=!0;const e=document.getElementById("manage-content-grid"),t=document.getElementById("load-more-manage-content"),n=30*(fa-1),a=n+30;!function(e,t=!1){const n=document.getElementById("manage-content-grid");t||(n.innerHTML="");if(0===e.length&&!t)return void(n.innerHTML=`<p>${A("content.noImportedContent")}</p>`);e.forEach(e=>{const t=document.createElement("div");t.className="grid-card";const a=e.poster_path?`${P}/w300${e.poster_path}`:"https://via.placeholder.com/300x450?text=No+Image",s=e.title||e.name,o=(e.release_date||e.first_air_date||"").split("-")[0]||A("content.notAvailable"),i="movie"===e.media_type?A("content.type.movie"):A("content.type.series");t.innerHTML=`\n          <img src="${a}" alt="${s}" class="grid-poster">\n          <div class="grid-info">\n            <h3 class="grid-title">${s}</h3>\n            <div class="grid-meta">\n              <span>${o}</span>\n              <span>${i}</span>\n            </div>\n          </div>\n          <div class="grid-actions-2">\n            <button class="edit-btn"><i class="fas fa-edit"></i> ${A("actions.edit")}</button>\n            <button class="delete-btn" style="background-color: var(--error-color);"><i class="fas fa-trash"></i> ${A("actions.delete")}</button>\n          </div>\n        `,t.querySelector(".edit-btn").addEventListener("click",()=>{!function(e){ra=!0,da=e;const t=document.getElementById("import-options-form");t.reset();const n=document.getElementById("next-episode-note-group"),a=document.getElementById("next-episode-note");"tv"===e.media_type?(n.style.display="block",a.value=e.next_episode_note||""):(n.style.display="none",a.value="");const s=e.display_options||{},o=s.main_sections||[],i=s.home_sections||[],r=s.platforms||[];o.forEach(e=>{const n=t.querySelector(`input[name="main-section"][value="${e}"]`);n&&(n.checked=!0)}),i.forEach(e=>{const n=t.querySelector(`input[name="home-section"][value="${e}"]`);n&&(n.checked=!0)}),r.forEach(e=>{const n=t.querySelector(`input[name="platform-section"][value="${e}"]`);n&&(n.checked=!0)}),document.getElementById("import-options-title").textContent=A("modal.editDisplayOptions"),yt.textContent=A("modal.saveAndContinueButton"),mt.style.display="flex"}(e)}),t.querySelector(".delete-btn").addEventListener("click",()=>{As(e.id)}),n.appendChild(t)})}(Ea.slice(n,a),!0),fa++,t&&(a>=Ea.length?t.parentElement.style.display="none":t.parentElement.style.display="block"),0===Ea.length&&0===n&&(e.innerHTML=`<p>${A("content.noContent")}</p>`),ha=!1}function js(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=function(e){const t=e.target.result.split("\n").filter(e=>""!==e.trim());let n=0,a=0;t.forEach(e=>{const t=e.split(",").map(e=>e.trim());if(3===t.length){const[e,s,o]=t,i=parseInt(e,10),r=parseInt(s,10);if(isNaN(i)||isNaN(r)||!o)a++;else{const e=document.getElementById(`video-url-s${i}-e${r}`);e?(e.value=o,n++):a++}}else a++}),_a(A("csv.importCompleteTitle"),`${n} ${A("csv.urlsImportedSuccess")} ${a>0?`${a} ${A("csv.rowsNotProcessed")}`:""}`,a>0?"info":"success")},n.onerror=function(){_a(A("csv.readErrorTitle"),A("csv.readErrorText"),"error")},n.readAsText(t),an.value=""}async function Os(){const e=document.getElementById("home-sections-container");e.innerHTML='<div class="spinner"></div>';try{const t=(await u(f(c(B,"home_sections"),E("order")))).docs.map(e=>({id:e.id,...e.data()}));if(e.innerHTML="",0===t.length)return void(e.innerHTML=`<p>${A("management.noHomeSections")}</p>`);t.forEach(t=>{const n=document.createElement("div");n.className="home-section-item",n.dataset.id=t.id,n.innerHTML=`\n        <span>${t.title}</span>\n        <div>\n          <button class="admin-action-btn edit-section-btn">${A("actions.edit")}</button>\n          <button class="admin-action-btn delete-section-btn">${A("actions.delete")}</button>\n        </div>\n      `,e.appendChild(n),n.querySelector(".edit-section-btn").addEventListener("click",()=>{Vs(t)}),n.querySelector(".delete-section-btn").addEventListener("click",async()=>{confirm(`¬øEst√°s seguro de que quieres eliminar la secci√≥n "${t.title}"?`)&&(await T(g(B,"home_sections",t.id)),Os())})})}catch(t){console.error("Error loading home sections:",t),e.innerHTML=`<p>${A("management.loadHomeSectionsError")}</p>`}new Sortable(e,{animation:150,onEnd:async function(t){const n=Array.from(e.children),a=I(B);n.forEach((e,t)=>{const n=g(B,"home_sections",e.dataset.id);a.update(n,{order:t})});try{await a.commit()}catch(e){console.error("Error updating sections order:",e),_a(A("modal.errorTitle"),A("management.saveOrderError"),"error")}}})}function Vs(e=null,t){const n=document.getElementById("section-modal");n.dataset.collection=t;const a=document.getElementById("section-modal-title"),s=document.getElementById("section-form"),o=document.getElementById("section-type");s.reset(),document.getElementById("section-id").value="",document.getElementById("section-options").innerHTML="",o.innerHTML="modal_sections"===t?'\n      <option value="ad_script_modal">Anuncio (Script)</option>\n    ':'\n      <option value="category" data-translate="management.sectionTypeCategory">Categor√≠a</option>\n      <option value="single_image" data-translate="management.sectionTypeSingleImage">Imagen √önica</option>\n      <option value="view" data-translate="management.sectionTypeView">Vista</option>\n      <option value="ad_script" data-translate="management.sectionTypeAdScript">Anuncio (Script)</option>\n      <option value="ad_video" data-translate="management.sectionTypeAdVideo">Anuncio (Video Emergente)</option>\n    ',e?(a.textContent=A("management.editSection"),document.getElementById("section-id").value=e.id,document.getElementById("section-title-input").value=e.title,o.value=e.type,Fs(e.type,e.options)):(a.textContent=A("management.addSection"),Fs(o.value)),n.style.display="flex"}function Fs(e,t={}){const n=document.getElementById("section-options");switch(n.innerHTML="",e){case"category":n.innerHTML=`\n        <div class="form-group">\n          <label for="section-category" data-translate="management.category">${A("management.category")}</label>\n          <select id="section-category" class="form-input">\n            ${D.map(e=>`<option value="${e.genreId}">${A(e.key)}</option>`).join("")}\n          </select>\n        </div>`,t.categoryId&&(document.getElementById("section-category").value=t.categoryId);break;case"single_image":n.innerHTML=`\n        <div id="image-carousel-options"></div>\n        <button type="button" id="add-image-btn" class="auth-btn" style="margin-top: 10px;">${A("management.addImage")}</button>\n      `;const e=document.getElementById("image-carousel-options"),a=(t=[])=>{e.innerHTML="",(t.length>0?t:[{imageUrl:"",linkType:"movie",linkId:""}]).forEach((t,n)=>{const a=document.createElement("div");a.className="image-option-group",a.innerHTML=`\n            <h5>Imagen ${n+1}</h5>\n            <div class="form-group">\n              <label for="section-image-url-${n}">${A("management.imageUrl")}</label>\n              <input type="text" id="section-image-url-${n}" class="form-input" value="${t.imageUrl||""}">\n            </div>\n            <div class="form-group">\n              <label for="section-link-type-${n}">${A("management.linkType")}</label>\n              <select id="section-link-type-${n}" class="form-input">\n                <option value="movie">${A("management.linkTypeMovie")}</option>\n                <option value="series">${A("management.linkTypeSeries")}</option>\n                <option value="view">${A("management.linkTypeView")}</option>\n                <option value="link">${A("management.linkTypeLink")}</option>\n              </select>\n            </div>\n            <div class="form-group">\n              <label for="section-link-id-${n}">${A("management.linkId")}</label>\n              <input type="text" id="section-link-id-${n}" class="form-input" value="${t.linkId||""}">\n            </div>\n            <div class="form-group">\n              <label for="section-embed-url-${n}">${A("management.embedUrl")}</label>\n              <input type="text" id="section-embed-url-${n}" class="form-input" value="${t.embedUrl||""}">\n            </div>\n          `,e.appendChild(a),document.getElementById(`section-link-type-${n}`).value=t.linkType||"movie"})};a(t.images),document.getElementById("add-image-btn").addEventListener("click",()=>{const t=Array.from(e.querySelectorAll(".image-option-group")).map((e,t)=>({imageUrl:document.getElementById(`section-image-url-${t}`).value,linkType:document.getElementById(`section-link-type-${t}`).value,linkId:document.getElementById(`section-link-id-${t}`).value,embedUrl:document.getElementById(`section-embed-url-${t}`).value}));t.push({imageUrl:"",linkType:"movie",linkId:"",embedUrl:""}),a(t)});break;case"view":n.innerHTML=`\n        <div class="form-group">\n          <label for="section-view" data-translate="management.view">${A("management.view")}</label>\n          <select id="section-view" class="form-input">\n            <option value="movies">${A("nav.movies")}</option>\n            <option value="series">${A("nav.series")}</option>\n            <option value="animes">${A("nav.animes")}</option>\n            <option value="doramas">${A("nav.doramas")}</option>\n          </select>\n        </div>`,t.view&&(document.getElementById("section-view").value=t.view);break;case"ad_script":n.innerHTML=`\n        <div class="form-group">\n          <label for="section-ad-script" data-translate="management.adScript">${A("management.adScript")}</label>\n          <textarea id="section-ad-script" class="form-input">${t.script||""}</textarea>\n        </div>`;break;case"ad_video":n.innerHTML=`\n        <div class="form-group">\n          <label for="section-ad-video-url" data-translate="management.adVideoUrl">${A("management.adVideoUrl")}</label>\n          <input type="text" id="section-ad-video-url" class="form-input" value="${t.videoUrl||""}">\n        </div>`;break;case"ad_script_modal":n.innerHTML=`\n        <div class="form-group">\n          <label for="section-ad-script" data-translate="management.adScript">${A("management.adScript")}</label>\n          <textarea id="section-ad-script" class="form-input">${t.script||""}</textarea>\n        </div>\n        <div class="form-group">\n          <label for="section-position">Posici√≥n</label>\n          <select id="section-position" class="form-input">\n            <option value="modal-header-new">Debajo del modal-header-new</option>\n            <option value="modal-btn modal-btn-primary">Debajo del modal-btn modal-btn-primary</option>\n            <option value="media-options-container">Debajo del media-options-container</option>\n            <option value="modal-overview-new">Debajo del modal-overview-new</option>\n          </select>\n        </div>`,t.position&&(document.getElementById("section-position").value=t.position)}}async function zs(){const e=document.getElementById("modal-sections-container");e.innerHTML='<div class="spinner"></div>';try{const t=(await u(c(B,"modal_sections"))).docs.map(e=>({id:e.id,...e.data()}));if(t.sort((e,t)=>(e.order||0)-(t.order||0)),e.innerHTML="",0===t.length)return void(e.innerHTML=`<p>${A("management.noHomeSections")}</p>`);t.forEach(t=>{const n=document.createElement("div");n.className="home-section-item",n.dataset.id=t.id,n.innerHTML=`\n        <span>${t.title}</span>\n        <div>\n          <button class="admin-action-btn edit-section-btn">${A("actions.edit")}</button>\n          <button class="admin-action-btn delete-section-btn">${A("actions.delete")}</button>\n        </div>\n      `,e.appendChild(n),n.querySelector(".edit-section-btn").addEventListener("click",()=>{Vs(t,"modal_sections")}),n.querySelector(".delete-section-btn").addEventListener("click",async()=>{confirm(`¬øEst√°s seguro de que quieres eliminar la secci√≥n "${t.title}"?`)&&(await T(g(B,"modal_sections",t.id)),zs())})})}catch(t){console.error("Error loading modal sections:",t),e.innerHTML=`<p>${A("management.loadHomeSectionsError")}</p>`}new Sortable(e,{animation:150,onEnd:async function(t){const n=Array.from(e.children),a=I(B);n.forEach((e,t)=>{const n=g(B,"modal_sections",e.dataset.id);a.update(n,{order:t})});try{await a.commit()}catch(e){console.error("Error updating sections order:",e),_a(A("modal.errorTitle"),A("management.saveOrderError"),"error")}}})}async function Gs(){const e=document.getElementById("section-id").value,t=document.getElementById("section-modal").dataset.collection,n=document.getElementById("section-title-input").value,a=document.getElementById("section-type").value;let s={};if(!n)return void _a(A("modal.validationErrorTitle"),A("management.sectionTitleRequired"),"error");switch(a){case"category":s.categoryId=document.getElementById("section-category").value;break;case"single_image":s.images=Array.from(document.getElementById("image-carousel-options").querySelectorAll(".image-option-group")).map((e,t)=>({imageUrl:document.getElementById(`section-image-url-${t}`).value,linkType:document.getElementById(`section-link-type-${t}`).value,linkId:document.getElementById(`section-link-id-${t}`).value,embedUrl:document.getElementById(`section-embed-url-${t}`).value}));break;case"view":s.view=document.getElementById("section-view").value;break;case"ad_script":s.script=document.getElementById("section-ad-script").value;break;case"ad_video":s.videoUrl=document.getElementById("section-ad-video-url").value;break;case"ad_script_modal":s.script=document.getElementById("section-ad-script").value,s.position=document.getElementById("section-position").value}const o={title:n,type:a,options:s};fs();try{if(e)await y(g(B,t,e),o,{merge:!0});else{const e=await u(c(B,t));o.order=e.size,await m(c(B,t),o)}document.getElementById("section-modal").style.display="none","home_sections"===t?Os():zs()}catch(e){console.error("Error saving section:",e),_a(A("modal.errorTitle"),A("management.saveSectionError"),"error")}finally{hs()}}document.addEventListener("DOMContentLoaded",()=>{!async function(){fs();try{await async function(){try{const e=g(B,"web_config","settings"),t=await p(e);if(t.exists()){const e=t.data();Fn={...Fn,...e,heroSlider:{...Fn.heroSlider,...e.heroSlider},homepageSections:{...Fn.homepageSections,...e.homepageSections}},console.log("Web settings loaded from Firestore.")}else console.log("No web settings found in Firestore, using defaults and saving them."),await y(e,Fn)}catch(e){console.error("Error loading web settings, using defaults:",e)}}(),M(),function(){window.addEventListener("scroll",ns(()=>{window.scrollY>50?te.classList.add("scrolled"):te.classList.remove("scrolled"),ps(),Hs()},100)),window.addEventListener("resize",as(()=>{document.querySelectorAll(".slider-container").forEach(e=>{const t=e.clientWidth,n=t<768?140:t<992?200:240;e.querySelectorAll(".content-card").forEach(e=>{e.style.flexBasis=n-16+"px"})})},200)),ne.addEventListener("click",ds),ae.addEventListener("keyup",function(e){"Enter"===e.key&&ls()}),ae.addEventListener("input",function(){document.activeElement===ae&&ae.value.trim()&&ls()}),document.addEventListener("click",e=>{!e.target.closest(".search-container")&&ae.classList.contains("active")&&ae.classList.remove("active")}),window.addEventListener("scroll",ps),se.addEventListener("click",gs),ie.addEventListener("click",ys),de.forEach(e=>{e.addEventListener("click",us)}),ve.addEventListener("click",Ya),ge.forEach(e=>{e.addEventListener("click",function(){os(this.closest(".content-slider").querySelector(".slider-container"),"prev")})}),ye.forEach(e=>{e.addEventListener("click",function(){os(this.closest(".content-slider").querySelector(".slider-container"),"next")})}),on.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.dataset.section;Wa(t),on.forEach(e=>e.classList.remove("active")),this.classList.add("active"),sn.forEach(e=>{e.dataset.section===t?e.classList.add("active"):e.classList.remove("active")})})}),sn.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const t=this.dataset.section;Wa(t),sn.forEach(e=>e.classList.remove("active")),this.classList.add("active"),on.forEach(e=>{e.dataset.section===t?e.classList.add("active"):e.classList.remove("active")})})}),rn&&rn.addEventListener("click",function(e){e.preventDefault(),Wa("movies")});dn&&dn.addEventListener("click",function(e){e.preventDefault(),Wa("series")});ln&&ln.addEventListener("click",function(e){e.preventDefault(),Wa("en-estreno")});cn&&cn.addEventListener("click",()=>Wa("home"));mn&&mn.addEventListener("click",()=>Wa("home"));un&&un.addEventListener("click",()=>Wa("home"));pn&&pn.addEventListener("click",()=>Wa("home"));gn&&gn.addEventListener("click",()=>Wa("home"));yn&&yn.addEventListener("click",()=>Wa("home"));vn&&vn.addEventListener("click",()=>Wa("home"));["netflix","disney","hbo","prime","paramount","stats","connected-users"].forEach(e=>{const t=document.getElementById(`back-from-${e}`);t&&t.addEventListener("click",()=>Wa("home"))}),fe&&fe.addEventListener("click",()=>{if(na){const e=he.classList.contains("active");he.classList.toggle("active"),!e&&he.classList.contains("active")&&async function(){if(!na)return;try{const e=f(c(B,"messages"),h("to","in",[na.id,"all"]),h("read","==",!1)),t=await u(e);if(t.empty)return;const n=I(B);t.forEach(e=>{n.update(e.ref,{read:!0})}),await n.commit(),Aa(0)}catch(e){console.error("Error marking messages as read:",e)}}()}else Sa()});document&&document.addEventListener("click",e=>{na&&he&&!e.target.closest(".user-profile")&&he.classList.contains("active")&&he.classList.remove("active")});Ce&&Ce.addEventListener("click",()=>{Ee.classList.remove("active"),Wa("home")});Oe&&Oe.addEventListener("click",()=>{Pe.classList.remove("active"),Wa("home")});Ye&&Ye.addEventListener("click",()=>Wa("home"));Se.forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.tab;Se.forEach(e=>e.classList.remove("active")),ke.forEach(e=>e.classList.remove("active")),this.classList.add("active"),document.getElementById(`${e}-section`).classList.add("active"),"my-list"===e?xa():"messages"===e&&(Ca(),Ma())})}),De.forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.tab;let t;De.forEach(e=>e.classList.remove("active")),this.classList.add("active"),He.forEach(e=>{e.style.display="none"}),t="messages"===e?document.getElementById("admin-messages-section"):document.getElementById(`${e}-section`),t&&(t.style.display="block","users"===e?Ua():"messages"===e&&(async function(){if(!aa)return;try{for(;Re.options.length>1;)Re.remove(1);(await u(c(B,"users"))).forEach(e=>{const t=e.data(),n=document.createElement("option");n.value=e.id,n.textContent=t.name,Re.appendChild(n)})}catch(e){console.error("Error loading message recipients:",e)}}(),function(){if(console.log("Paso 1: Se llam√≥ a loadAdminMessages. El valor de isAdmin es:",aa),!aa)return;try{sa.admin&&sa.admin(),Ze.innerHTML=`\n      <div class="message-item" style="text-align: center;">\n        <div class="spinner" style="width: 30px; height: 30px; margin: 0 auto;"></div>\n        <p style="margin-top: 10px;">${A("user.messages.loading")}</p>\n      </div>\n    `,Qe.style.display="none";const e=f(c(B,"messages"),h("to","==","admin"),E("date","desc")),t=w(e,async e=>{console.log("Paso 2: Respuesta de Firestore recibida. Documentos:",e.size);const t=[];for(const n of e.docs){const e=n.data();if("admin"!==e.from)try{const a=await p(g(B,"users",e.from)),s=a.exists()?a.data().name:A("admin.unknownUser");t.push({id:n.id,...e,userName:e.userName||s})}catch(a){console.error("Error getting user data for message:",a),t.push({id:n.id,...e,userName:A("admin.unknownUser")})}else t.push({id:n.id,...e})}console.log("Paso 3: Mensajes procesados. Total:",t.length),t.length>0?(Qe.style.display="none",Ze.innerHTML="",t.forEach(e=>{const t=e.date instanceof Date?e.date:e.date?.toDate?.()||new Date,n=document.createElement("div");n.className="message-item",n.innerHTML=`\n            <div class="message-header">\n              <span class="message-sender">${A("admin.fromLabel")} ${e.userName||A("admin.user")}</span>\n              <span class="message-date">${t.toLocaleString()}</span>\n            </div>\n            <div class="message-content">${e.content}</div>\n            <div class="message-actions">\n              <button class="message-delete-btn" data-id="${e.id}">\n                <i class="fas fa-trash"></i>\n              </button>\n              <button class="admin-action-btn message" data-id="${e.from}" data-name="${e.userName||A("admin.user")}" style="margin-left: 10px; background-color: var(--accent-color); color: white; border-radius: 4px; padding: 4px 8px; font-size: 0.8rem;">\n                <i class="fas fa-reply"></i> ${A("actions.reply")}\n              </button>\n            </div>\n          `,Ze.appendChild(n);n.querySelector(".message-delete-btn").addEventListener("click",()=>{Pa(e.id)});n.querySelector(".admin-action-btn.message").addEventListener("click",()=>{Oa(e.from,e.userName||A("admin.user"))})})):(console.log("Paso 4: No hay mensajes para renderizar."),Qe.style.display="block",Ze.innerHTML="")},e=>{console.error("Error loading admin messages:",e),Qe.style.display="none",Ze.innerHTML=`\n        <div class="empty-state">\n          <i class="fas fa-exclamation-circle empty-icon"></i>\n          <h3 class="empty-title">${A("user.messages.loadError")}</h3>\n          <p class="empty-text">${A("user.messages.loadError")}</p>\n        </div>\n      `});sa.admin=t}catch(e){console.error("Error setting up admin message listener:",e),Qe.style.display="none",Ze.innerHTML=`\n        <div class="empty-state">\n          <i class="fas fa-exclamation-circle empty-icon"></i>\n          <h3 class="empty-title">${A("user.messages.loadError")}</h3>\n          <p class="empty-text">${A("user.messages.loadError")}</p>\n        </div>\n      `}}()))})}),We.forEach(e=>{e.addEventListener("click",function(){const e=this.dataset.tab;We.forEach(e=>e.classList.remove("active")),this.classList.add("active"),Xe.forEach(e=>{e.style.display="none"});const t=document.getElementById(`${e}-section`);t&&(t.style.display="block","manage-content"===e?Us():"home-sections"===e?Os():"modal-sections"===e&&zs())})}),document.getElementById("add-section-btn").addEventListener("click",()=>{Vs(null,"home_sections")}),document.getElementById("add-modal-section-btn").addEventListener("click",()=>{Vs(null,"modal_sections")}),document.getElementById("section-type").addEventListener("change",e=>{Fs(e.target.value)}),document.getElementById("save-section-btn").addEventListener("click",Gs),document.getElementById("close-section-modal").addEventListener("click",()=>{document.getElementById("section-modal").style.display="none"}),document.getElementById("cancel-section").addEventListener("click",()=>{document.getElementById("section-modal").style.display="none"});const e=document.getElementById("tmdb-search-btn");e&&e.addEventListener("click",_s);const t=document.getElementById("seed-database-btn");t&&t.addEventListener("click",Ps);qe&&qe.addEventListener("submit",Fa);Me&&Me.addEventListener("click",Na);Je&&Je.addEventListener("submit",Ms);bt&&bt.addEventListener("click",()=>vt.style.display="none");Lt&&Lt.addEventListener("click",()=>vt.style.display="none");wt&&wt.addEventListener("click",ja);kt&&kt.addEventListener("click",()=>It.style.display="none");_t&&_t.addEventListener("click",()=>It.style.display="none");Bt&&Bt.addEventListener("click",Va);At&&At.addEventListener("click",()=>xt.style.display="none");Mt&&Mt.addEventListener("click",()=>xt.style.display="none");Nt&&Nt.addEventListener("click",za);Ht&&Ht.addEventListener("click",()=>Pt.style.display="none");Ut&&Ut.addEventListener("click",()=>Pt.style.display="none");qt&&qt.addEventListener("click",Da);jt&&jt.addEventListener("click",()=>Rt.style.display="none");Ot&&Ot.addEventListener("click",()=>Rt.style.display="none");Vt&&Vt.addEventListener("click",Ns);Jt&&Jt.addEventListener("click",e=>{e.preventDefault(),Zt.style.display="none"});en&&en.addEventListener("click",e=>{e.preventDefault(),Zt.style.display="none"});tn&&tn.addEventListener("click",e=>{e.preventDefault(),e.preventDefault(),ra?async function(){if(!da)return;fs();const e={};if("movie"===da.media_type)e.video_url=document.getElementById("movie-video-url").value.trim();else if("tv"===da.media_type){const t=JSON.parse(JSON.stringify(da.seasons));for(const e in t){const n=t[e];for(const e in n.episodes){const t=n.episodes[e],a=document.getElementById(`video-url-s${n.season_number}-e${t.episode_number}`);a&&(t.video_url=a.value.trim())}}e.seasons=t}try{const t=g(B,"content",String(da.id));await v(t,e);const n=Wn.findIndex(e=>e.id===da.id);n>-1&&(Wn[n]={...Wn[n],...e}),Zt.style.display="none",_a(A("modal.successTitle"),A("modal.urlsUpdatedSuccess"),"success"),Us()}catch(e){console.error("Error updating content URLs:",e),_a(A("modal.errorTitle"),A("modal.urlsUpdatedError"),"error")}finally{hs(),ra=!1,da=null}}():function(){if(!oa)return;"movie"===oa.media_type?oa.video_url=document.getElementById("movie-video-url").value.trim():"tv"===oa.media_type&&oa.seasons.forEach(e=>{e.episodes&&e.episodes.forEach(t=>{const n=document.getElementById(`video-url-s${e.season_number}-e${t.episode_number}`);n&&(t.video_url=n.value.trim())})}),Zt.style.display="none",mt.style.display="flex",document.getElementById("import-options-form").reset(),pt.style.display="block";const e=document.getElementById("next-episode-note-group");"tv"===oa.media_type?e.style.display="block":e.style.display="none"}()});nn&&nn.addEventListener("click",()=>an.click());an&&an.addEventListener("change",js);const n=document.getElementById("google-login-btn");n&&n.addEventListener("click",La);const a=document.getElementById("google-register-btn");a&&a.addEventListener("click",La);if(le){let e=0,t=0;le.addEventListener("touchstart",n=>{clearInterval(Vn),Yn=!1,e=n.touches[0].clientX,t=n.touches[0].clientX}),le.addEventListener("touchmove",e=>{t=e.touches[0].clientX}),le.addEventListener("touchend",()=>{const n=t-e;n>50?rs((Gn-1+ea.length)%ea.length,!1):n<-50&&rs((Gn+1)%ea.length,!1)})}ze&&ze.addEventListener("input",as(qa,300));const s=document.getElementById("load-more-users");s&&s.addEventListener("click",Ra);const o=document.getElementById("manage-content-search-input");o&&o.addEventListener("input",as(qs,300));const i=document.getElementById("load-more-manage-content");i&&i.addEventListener("click",Rs);const r=e=>{if(e&&e.preventDefault(),mt){mt.style.display="none";const e=document.getElementById("import-options-title");e&&(e.textContent=A("modal.importOptionsTitle")),yt&&(yt.textContent=A("modal.importButton")),ra&&(ra=!1,da=null)}};ut&&ut.addEventListener("click",r);gt&&gt.addEventListener("click",r);yt&&yt.addEventListener("click",e=>{e.preventDefault(),async function(e){e.preventDefault();const t=ra?da:oa;if(!t)return;fs();try{const e=Array.from(document.querySelectorAll('input[name="main-section"]:checked')).map(e=>e.value),n=Array.from(document.querySelectorAll('input[name="home-section"]:checked')).map(e=>e.value),a={main_sections:e,home_sections:n,platforms:Array.from(document.querySelectorAll('input[name="platform-section"]:checked')).map(e=>e.value)};if(ra){const e=g(B,"content",String(t.id)),n={display_options:a};"tv"===t.media_type&&(n.next_episode_note=document.getElementById("next-episode-note").value.trim()),await v(e,n);const s=Wn.findIndex(e=>e.id===t.id);s>-1&&(Wn[s].display_options=a,"tv"===t.media_type&&(Wn[s].next_episode_note=n.next_episode_note),da.display_options=a),mt.style.display="none",document.getElementById("next-episode-note-group").style.display="none",document.getElementById("import-options-title").textContent=A("modal.importOptionsTitle"),yt.textContent=A("modal.importButton"),await xs(da)}else{"movie"!==t.media_type||e.includes("movies")||e.push("movies"),"tv"!==t.media_type||e.includes("series")||e.push("series"),a.main_sections=e;const n={id:t.id,media_type:t.media_type,title:t.title||t.name,original_title:t.original_title||t.original_name,overview:t.overview,poster_path:t.poster_path,backdrop_path:t.backdrop_path,release_date:t.release_date||t.first_air_date,vote_average:t.vote_average,genres:t.genres?t.genres.map(e=>e.id):t.genre_ids||[],imported_at:L(),imported_by:na.email,display_options:a};if("movie"===t.media_type)n.video_url=t.video_url||"";else if("tv"===t.media_type){n.next_episode_note=document.getElementById("next-episode-note").value.trim();const e={};t.seasons&&t.seasons.filter(e=>0!==e.season_number).forEach(t=>{const n={};t.episodes&&t.episodes.forEach(e=>{n[e.episode_number]={episode_number:e.episode_number,name:e.name,overview:e.overview,air_date:e.air_date,still_path:e.still_path,video_url:e.video_url||""}}),e[t.season_number]={season_number:t.season_number,name:t.name,poster_path:t.poster_path,air_date:t.air_date,episodes:n}}),n.seasons=e}const s=g(B,"content",String(t.id));await y(s,n);const o={...n,imported_at:{seconds:Math.floor((new Date).getTime()/1e3)}};Wn.push(o),Zn=Wn.filter(e=>"movie"===e.media_type),Qn=Wn.filter(e=>"tv"===e.media_type),await Cs(),_a(A("modal.successTitle"),A("modal.importSuccess",{title:n.title}),"success"),mt.style.display="none",document.getElementById("next-episode-note-group").style.display="none",oa=null}}catch(e){console.error("Error en confirmImportWithSections:",e),_a(A("modal.errorTitle"),A("modal.saveOptionsError"),"error")}finally{hs()}}(e)});const d=document.getElementById("trailer-modal"),l=document.getElementById("close-trailer-modal"),m=document.getElementById("trailer-iframe"),b=()=>{d.style.display="none",m.src=""};d&&d.addEventListener("click",e=>{e.target===d&&b()});l&&l.addEventListener("click",b)}(),d(_,async e=>{if(e){ka();try{const t=await p(g(B,"users",e.uid));if(t.exists())na={id:e.uid,...t.data()};else{const t={name:e.displayName||e.email.split("@")[0],email:e.email,registeredAt:L(),myList:[],messagesSent:[],lastActivity:L(),isAdmin:e.email===ba};await y(g(B,"users",e.uid),t),na={id:e.uid,...t}}aa=na.email===ba,v(g(B,"users",e.uid),{lastActivity:L()})}catch(e){console.error("Error getting user data:",e)}}else na=null,aa=!1;$a();try{await Ka(),function(){const e=localStorage.getItem("dontShowPopupAgain");"true"!==e&&(oe.style.display="flex")}()}catch(e){console.error("Failed to load initial content:",e)}}),j.addEventListener("submit",wa),O.addEventListener("submit",Ia),K.addEventListener("click",()=>{q.style.display="none",R.style.display="block"}),J.addEventListener("click",()=>{R.style.display="none",q.style.display="block"}),U.addEventListener("click",ka)}catch(e){console.error("Error initializing app:",e)}finally{hs()}}()}),document.addEventListener("DOMContentLoaded",()=>{Hs()}),function(){function e(){var e=document.getElementById("floating-donation-btn"),t=document.getElementById("donation-modal"),n=document.getElementById("close-donation-modal"),a=document.getElementById("cancel-donation"),s=document.getElementById("paypal-donate-btn"),o=t.querySelector(".modal-overlay");function i(){t.style.display="none"}e&&t&&n&&a&&s?(e.onclick=function(){t.style.display="block"},n.onclick=i,a.onclick=i,s.onclick=function(){window.open("https://www.paypal.com/donate/?hosted_button_id=8TVX4VWNBWVM4","_blank")},o.onclick=function(e){e.target===o&&i()}):console.error(A("donation.elementsNotFound"))}"loading"===document.readyState?window.addEventListener("load",e):e()}(),window.setLanguageForTesting=async function(e){Fn.displayLanguage=e,M(),$a();ss(await ws())};
